var va=s=>{throw TypeError(s)};var nn=(s,e,t)=>e.has(s)?va("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);function Ca(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(s,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function Ci(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var vs,Lr;function Ta(){return Lr||(Lr=1,vs={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",Á:".--.-",Ä:".-.-",É:"..-..",Ñ:"--.--",Ö:"---.",Ü:"..--",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",0:"-----",",":"--..--",".":".-.-.-","?":"..--..",";":"-.-.-",":":"---...","/":"-..-.","-":"-....-","'":".----.","()":"-.--.-",_:"..--.-","@":".--.-."," ":"......."}),vs}var Cs,jr;function ba(){return jr||(jr=1,Cs={".":{stop:"E",".":{stop:"I",".":{stop:"S",".":{stop:"H",".":{stop:"5"},"-":{stop:"4"}},"-":{stop:"V",".":{stop:"Ś"},"-":{stop:"3"}}},"-":{stop:"U",".":{stop:"F",".":{stop:"É"}},_:{stop:"Ü",".":{stop:"Ð",".":{stop:"?"},"-":{stop:"_"}},"-":{stop:"2"}}}},"-":{stop:"A",".":{stop:"R",".":{stop:"L","-":{stop:"È",".":{stop:'"'}}},"-":{stop:"Ä",".":{stop:"+","-":{stop:"."}}}},"-":{stop:"W",".":{stop:"P","-":{stop:"À",".":{stop:"@"}}},"-":{stop:"J",".":{stop:"Ĵ"},"-":{stop:"1",".":{stop:"'"}}}}}},"-":{stop:"T",".":{stop:"N",".":{stop:"D",".":{stop:"B",".":{stop:"6","-":{stop:"-"}},"-":{stop:"="}},"-":{stop:"X",".":{stop:"/"}}},"-":{stop:"K",".":{stop:"C",".":{stop:"Ç"},"-":{".":{stop:";"},"-":{stop:"!"}}},"-":{stop:"Y",".":{stop:"Ĥ","-":{stop:"()"}}}}},"-":{stop:"M",".":{stop:"G",".":{stop:"Z",".":{stop:"7"},"-":{"-":{stop:","}}},"-":{stop:"Q",".":{stop:"Ĝ"},"-":{stop:"Ñ"}}},"-":{stop:"O",".":{stop:"Ö",".":{stop:"8",".":{stop:":"}}},"-":{stop:"CH",".":{stop:"9"},"-":{stop:"0"}}}}}}),Cs}var Ts,Br;function Sa(){if(Br)return Ts;Br=1,Ts={encode:t,decode:n,map:s,tree:e};var s=Ta(),e=ba();function t(a){return r(a,c);function c(l){var u=l.split("");for(var h in u)u[h]=s[u[h].toUpperCase()]||"?";return u.join(" ")}}function n(a,c){return r(a,l);function l(u){var h=u.split(" ");for(var d in h)c?h[d]=o(h[d]):h[d]=i(h[d]);return h.join("")}}function r(a,c){if(!a.pop)return c(a);for(var l=[],u=0;u<a.length;u++)l[u]=c(a[u]);return l}function i(a){for(var c in s)if(s[c]==a)return c;return" "}function o(a){var c=a.split("");return l(e,c);function l(u,h){var d=h.shift();return u[d]?l(u[d],h):u.stop||"?"}}return Ts}var ka=Sa();const xa=Ci(ka),Ti="15.0.4",Wr=(s,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:s}),qr=(s,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:s}),ws=(s,e)=>({startTime:e,type:"setValue",value:s}),bi=(s,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:s}),Si=(s,e,{startTime:t,target:n,timeConstant:r})=>n+(e-n)*Math.exp((t-s)/r),Mt=s=>s.type==="exponentialRampToValue",jn=s=>s.type==="linearRampToValue",ct=s=>Mt(s)||jn(s),Zs=s=>s.type==="setValue",et=s=>s.type==="setValueCurve",Bn=(s,e,t,n)=>{const r=s[e];return r===void 0?n:ct(r)||Zs(r)?r.value:et(r)?r.values[r.values.length-1]:Si(t,Bn(s,e-1,r.startTime,n),r)},$r=(s,e,t,n,r)=>t===void 0?[n.insertTime,r]:ct(t)?[t.endTime,t.value]:Zs(t)?[t.startTime,t.value]:et(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,Bn(s,e-1,t.startTime,r)],As=s=>s.type==="cancelAndHold",Rs=s=>s.type==="cancelScheduledValues",at=s=>As(s)||Rs(s)?s.cancelTime:Mt(s)||jn(s)?s.endTime:s.startTime,Ur=(s,e,t,{endTime:n,value:r})=>t===r?r:0<t&&0<r||t<0&&r<0?t*(r/t)**((s-e)/(n-e)):0,zr=(s,e,t,{endTime:n,value:r})=>t+(s-e)/(n-e)*(r-t),wa=(s,e)=>{const t=Math.floor(e),n=Math.ceil(e);return t===n?s[t]:(1-(e-t))*s[t]+(1-(n-e))*s[n]},Aa=(s,{duration:e,startTime:t,values:n})=>{const r=(s-t)/e*(n.length-1);return wa(n,r)},wn=s=>s.type==="setTarget";class Ra{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=at(e);if(As(e)||Rs(e)){const n=this._automationEvents.findIndex(i=>Rs(e)&&et(i)?i.startTime+i.duration>=t:at(i)>=t),r=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),As(e)){const i=this._automationEvents[this._automationEvents.length-1];if(r!==void 0&&ct(r)){if(i!==void 0&&wn(i))throw new Error("The internal list is malformed.");const o=i===void 0?r.insertTime:et(i)?i.startTime+i.duration:at(i),a=i===void 0?this._defaultValue:et(i)?i.values[i.values.length-1]:i.value,c=Mt(r)?Ur(t,o,a,r):zr(t,o,a,r),l=Mt(r)?Wr(c,t,this._currenTime):qr(c,t,this._currenTime);this._automationEvents.push(l)}if(i!==void 0&&wn(i)&&this._automationEvents.push(ws(this.getValue(t),t)),i!==void 0&&et(i)&&i.startTime+i.duration>t){const o=t-i.startTime,a=(i.values.length-1)/i.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=i.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=i.values[h-1]*(1-d)+i.values[h]*d}this._automationEvents[this._automationEvents.length-1]=bi(u,i.startTime,o)}}}else{const n=this._automationEvents.findIndex(o=>at(o)>t),r=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(r!==void 0&&et(r)&&at(r)+r.duration>t)return!1;const i=Mt(e)?Wr(e.value,e.endTime,this._currenTime):jn(e)?qr(e.value,t,this._currenTime):e;if(n===-1)this._automationEvents.push(i);else{if(et(e)&&t+e.duration>at(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,i)}}return!0}flush(e){const t=this._automationEvents.findIndex(n=>at(n)>e);if(t>1){const n=this._automationEvents.slice(t-1),r=n[0];wn(r)&&n.unshift(ws(Bn(this._automationEvents,t-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>at(o)>e),n=this._automationEvents[t],r=(t===-1?this._automationEvents.length:t)-1,i=this._automationEvents[r];if(i!==void 0&&wn(i)&&(n===void 0||!ct(n)||n.insertTime>e))return Si(e,Bn(this._automationEvents,r-1,i.startTime,this._defaultValue),i);if(i!==void 0&&Zs(i)&&(n===void 0||!ct(n)))return i.value;if(i!==void 0&&et(i)&&(n===void 0||!ct(n)||i.startTime+i.duration>e))return e<i.startTime+i.duration?Aa(e,i):i.values[i.values.length-1];if(i!==void 0&&ct(i)&&(n===void 0||!ct(n)))return i.value;if(n!==void 0&&Mt(n)){const[o,a]=$r(this._automationEvents,r,i,n,this._defaultValue);return Ur(e,o,a,n)}if(n!==void 0&&jn(n)){const[o,a]=$r(this._automationEvents,r,i,n,this._defaultValue);return zr(e,o,a,n)}return this._defaultValue}}const Ea=s=>({cancelTime:s,type:"cancelAndHold"}),Oa=s=>({cancelTime:s,type:"cancelScheduledValues"}),Ia=(s,e)=>({endTime:e,type:"exponentialRampToValue",value:s}),Ma=(s,e)=>({endTime:e,type:"linearRampToValue",value:s}),Pa=(s,e,t)=>({startTime:e,target:s,timeConstant:t,type:"setTarget"}),Na=()=>new DOMException("","AbortError"),Da=s=>(e,t,[n,r,i],o)=>{s(e[r],[t,n,i],a=>a[0]===t&&a[1]===n,o)},Fa=s=>(e,t,n)=>{const r=[];for(let i=0;i<n.numberOfInputs;i+=1)r.push(new Set);s.set(e,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},Va=s=>(e,t)=>{s.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},jt=new WeakSet,ki=new WeakMap,Xs=new WeakMap,xi=new WeakMap,Hs=new WeakMap,Kn=new WeakMap,wi=new WeakMap,Es=new WeakMap,Os=new WeakMap,Is=new WeakMap,Ai={construct(){return Ai}},La=s=>{try{const e=new Proxy(s,Ai);new e}catch{return!1}return!0},Gr=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Yr=(s,e)=>{const t=[];let n=s.replace(/^[\s]+/,""),r=n.match(Gr);for(;r!==null;){const i=r[1].slice(1,-1),o=r[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,e).toString());t.push(o),n=n.slice(r[0].length).replace(/^[\s]+/,""),r=n.match(Gr)}return[t.join(";"),n]},Zr=s=>{if(s!==void 0&&!Array.isArray(s))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Xr=s=>{if(!La(s))throw new TypeError("The given value for processorCtor should be a constructor.");if(s.prototype===null||typeof s.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},ja=(s,e,t,n,r,i,o,a,c,l,u,h,d)=>{let p=0;return(f,m,g={credentials:"omit"})=>{const y=u.get(f);if(y!==void 0&&y.has(m))return Promise.resolve();const b=l.get(f);if(b!==void 0){const _=b.get(m);if(_!==void 0)return _}const S=i(f),x=S.audioWorklet===void 0?r(m).then(([_,C])=>{const[T,v]=Yr(_,C),R=`${T};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${v}
})})(window,'_AWGS')`;return t(R)}).then(()=>{const _=d._AWGS.pop();if(_===void 0)throw new SyntaxError;n(S.currentTime,S.sampleRate,()=>_(class{},void 0,(C,T)=>{if(C.trim()==="")throw e();const v=Os.get(S);if(v!==void 0){if(v.has(C))throw e();Xr(T),Zr(T.parameterDescriptors),v.set(C,T)}else Xr(T),Zr(T.parameterDescriptors),Os.set(S,new Map([[C,T]]))},S.sampleRate,void 0,void 0))}):Promise.all([r(m),Promise.resolve(s(h,h))]).then(([[_,C],T])=>{const v=p+1;p=v;const[R,A]=Yr(_,C),O=`${R};((AudioWorkletProcessor,registerProcessor)=>{${A}
})(${T?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${T?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${T?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${v}',class extends AudioWorkletProcessor{process(){return !1}})`,F=new Blob([O],{type:"application/javascript; charset=utf-8"}),P=URL.createObjectURL(F);return S.audioWorklet.addModule(P,g).then(()=>{if(a(S))return S;const N=o(S);return N.audioWorklet.addModule(P,g).then(()=>N)}).then(N=>{if(c===null)throw new SyntaxError;try{new c(N,`__sac${v}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(P))});return b===void 0?l.set(f,new Map([[m,x]])):b.set(m,x),x.then(()=>{const _=u.get(f);_===void 0?u.set(f,new Set([m])):_.add(m)}).finally(()=>{const _=l.get(f);_!==void 0&&_.delete(m)}),x}},Ue=(s,e)=>{const t=s.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},es=(s,e)=>{const t=Array.from(s).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[n]=t;return s.delete(n),n},Ri=(s,e,t,n)=>{const r=Ue(s,e),i=es(r,o=>o[0]===t&&o[1]===n);return r.size===0&&s.delete(e),i},fn=s=>Ue(wi,s),Bt=s=>{if(jt.has(s))throw new Error("The AudioNode is already stored.");jt.add(s),fn(s).forEach(e=>e(!0))},Ei=s=>"port"in s,mn=s=>{if(!jt.has(s))throw new Error("The AudioNode is not stored.");jt.delete(s),fn(s).forEach(e=>e(!1))},Ms=(s,e)=>{!Ei(s)&&e.every(t=>t.size===0)&&mn(s)},Ba=(s,e,t,n,r,i,o,a,c,l,u,h,d)=>{const p=new WeakMap;return(f,m,g,y,b)=>{const{activeInputs:S,passiveInputs:x}=i(m),{outputs:_}=i(f),C=a(f),T=v=>{const R=c(m),A=c(f);if(v){const w=Ri(x,f,g,y);s(S,f,w,!1),!b&&!h(f)&&t(A,R,g,y),d(m)&&Bt(m)}else{const w=n(S,f,g,y);e(x,y,w,!1),!b&&!h(f)&&r(A,R,g,y);const k=o(m);if(k===0)u(m)&&Ms(m,S);else{const I=p.get(m);I!==void 0&&clearTimeout(I),p.set(m,setTimeout(()=>{u(m)&&Ms(m,S)},k*1e3))}}};return l(_,[m,g,y],v=>v[0]===m&&v[1]===g&&v[2]===y,!0)?(C.add(T),u(f)?s(S,f,[g,y,T],!0):e(x,y,[f,g,T],!0),!0):!1}},Wa=s=>(e,t,[n,r,i],o)=>{const a=e.get(n);a===void 0?e.set(n,new Set([[r,t,i]])):s(a,[r,t,i],c=>c[0]===r&&c[1]===t,o)},qa=s=>(e,t)=>{const n=s(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const r=()=>{t.removeEventListener("ended",r),t.disconnect(n),n.disconnect()};t.addEventListener("ended",r)},$a=s=>(e,t)=>{s(e).add(t)},Ua={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},za=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=r(a),u={...Ua,...c},h=n(l,u),d=i(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},Ce=(s,e)=>s.context===e,Ga=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!Ce(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=s(o,l)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},Wn=s=>{try{s.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Je=()=>new DOMException("","IndexSizeError"),Js=s=>{s.getChannelData=(e=>t=>{try{return e.call(s,t)}catch(n){throw n.code===12?Je():n}})(s.getChannelData)},Ya={numberOfChannels:1},Za=(s,e,t,n,r,i,o,a)=>{let c=null;return class Oi{constructor(u){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:p}={...Ya,...u};c===null&&(c=new r(1,1,44100));const f=n!==null&&e(i,i)?new n({length:h,numberOfChannels:d,sampleRate:p}):c.createBuffer(d,h,p);if(f.numberOfChannels===0)throw t();return typeof f.copyFromChannel!="function"?(o(f),Js(f)):e(Wn,()=>Wn(f))||a(f),s.add(f),f}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===Oi.prototype||s.has(u)}}},Ie=-34028234663852886e22,be=34028234663852886e22,tt=s=>jt.has(s),Xa={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Ha=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const h=i(l),d={...Xa,...u},p=r(h,d),f=o(h),m=f?e():null;super(l,!1,p,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=p,this._onended=null,this._playbackRate=t(this,f,p.playbackRate,be,Ie)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){Bt(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),tt(this)&&mn(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},Ja=(s,e,t,n,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Ce(h,u);if(!d){const p={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,p),o!==null&&h.start(...o),a!==null&&h.stop(a)}return i.set(u,h),d?await s(u,l.playbackRate,h.playbackRate):await n(u,l.playbackRate,h.playbackRate),await r(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=i.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Qa=s=>"playbackRate"in s,Ka=s=>"frequency"in s&&"gain"in s,ec=s=>"offset"in s,tc=s=>!("frequency"in s)&&"gain"in s,nc=s=>"detune"in s&&"frequency"in s&&!("gain"in s),sc=s=>"pan"in s,Se=s=>Ue(ki,s),gn=s=>Ue(xi,s),Ps=(s,e)=>{const{activeInputs:t}=Se(s);t.forEach(r=>r.forEach(([i])=>{e.includes(s)||Ps(i,[...e,s])}));const n=Qa(s)?[s.playbackRate]:Ei(s)?Array.from(s.parameters.values()):Ka(s)?[s.Q,s.detune,s.frequency,s.gain]:ec(s)?[s.offset]:tc(s)?[s.gain]:nc(s)?[s.detune,s.frequency]:sc(s)?[s.pan]:[];for(const r of n){const i=gn(r);i!==void 0&&i.activeInputs.forEach(([o])=>Ps(o,e))}tt(s)&&mn(s)},Ii=s=>{Ps(s.destination,[])},rc=s=>s===void 0||typeof s=="number"||typeof s=="string"&&(s==="balanced"||s==="interactive"||s==="playback"),ic=(s,e,t,n,r,i,o,a,c)=>class extends s{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(f){throw f.code===12&&f.message==="sampleRate is not in range"?t():f}if(h===null)throw n();if(!rc(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:p}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/p:d==="interactive"||d===void 0?256/p:d==="playback"?1024/p:Math.max(2,Math.min(128,Math.round(d*p/128)))*128/p,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const f=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",f)};h.addEventListener("statechange",f)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ii(this)}))}createMediaElementSource(u){return new r(this,{mediaElement:u})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},oc=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const h=i(l),d=o(h),p=r(h,u,d),f=d?e(a):null;super(l,!1,p,f),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=p}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},ac=s=>{const e=new WeakMap,t=async(n,r)=>{const i=r.destination;return e.set(r,i),await s(n,r,i),i};return{render(n,r){const i=e.get(r);return i!==void 0?Promise.resolve(i):t(n,r)}}},cc=(s,e,t,n,r,i,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const _=new Float32Array(1),C=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),T=o(l);let v=!1,R=[0,0,-1,0,1,0],A=[0,0,0];const w=()=>{if(v)return;v=!0;const F=n(l,256,9,0);F.onaudioprocess=({inputBuffer:P})=>{const N=[i(P,_,0),i(P,_,1),i(P,_,2),i(P,_,3),i(P,_,4),i(P,_,5)];N.some((V,B)=>V!==R[B])&&(u.setOrientation(...N),R=N);const $=[i(P,_,6),i(P,_,7),i(P,_,8)];$.some((V,B)=>V!==A[B])&&(u.setPosition(...$),A=$)},C.connect(F)},k=F=>P=>{P!==R[F]&&(R[F]=P,u.setOrientation(...R))},I=F=>P=>{P!==A[F]&&(A[F]=P,u.setPosition(...A))},O=(F,P,N)=>{const $=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:P});$.connect(C,0,F),$.start(),Object.defineProperty($.offset,"defaultValue",{get(){return P}});const V=s({context:c},T,$.offset,be,Ie);return a(V,"value",B=>()=>B.call(V),B=>j=>{try{B.call(V,j)}catch(Z){if(Z.code!==9)throw Z}w(),T&&N(j)}),V.cancelAndHoldAtTime=(B=>T?()=>{throw r()}:(...j)=>{const Z=B.apply(V,j);return w(),Z})(V.cancelAndHoldAtTime),V.cancelScheduledValues=(B=>T?()=>{throw r()}:(...j)=>{const Z=B.apply(V,j);return w(),Z})(V.cancelScheduledValues),V.exponentialRampToValueAtTime=(B=>T?()=>{throw r()}:(...j)=>{const Z=B.apply(V,j);return w(),Z})(V.exponentialRampToValueAtTime),V.linearRampToValueAtTime=(B=>T?()=>{throw r()}:(...j)=>{const Z=B.apply(V,j);return w(),Z})(V.linearRampToValueAtTime),V.setTargetAtTime=(B=>T?()=>{throw r()}:(...j)=>{const Z=B.apply(V,j);return w(),Z})(V.setTargetAtTime),V.setValueAtTime=(B=>T?()=>{throw r()}:(...j)=>{const Z=B.apply(V,j);return w(),Z})(V.setValueAtTime),V.setValueCurveAtTime=(B=>T?()=>{throw r()}:(...j)=>{const Z=B.apply(V,j);return w(),Z})(V.setValueCurveAtTime),V};return{forwardX:O(0,0,k(0)),forwardY:O(1,0,k(1)),forwardZ:O(2,-1,k(2)),positionX:O(6,0,I(0)),positionY:O(7,0,I(1)),positionZ:O(8,0,I(2)),upX:O(3,0,k(3)),upY:O(4,1,k(4)),upZ:O(5,0,k(5))}},{forwardX:d,forwardY:p,forwardZ:f,positionX:m,positionY:g,positionZ:y,upX:b,upY:S,upZ:x}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return p},get forwardZ(){return f},get positionX(){return m},get positionY(){return g},get positionZ(){return y},get upX(){return b},get upY(){return S},get upZ(){return x}}},qn=s=>"context"in s,_n=s=>qn(s[0]),St=(s,e,t,n)=>{for(const r of s)if(t(r)){if(n)return!1;throw Error("The set contains at least one similar element.")}return s.add(e),!0},Hr=(s,e,[t,n],r)=>{St(s,[e,t,n],i=>i[0]===e&&i[1]===t,r)},Jr=(s,[e,t,n],r)=>{const i=s.get(e);i===void 0?s.set(e,new Set([[t,n]])):St(i,[t,n],o=>o[0]===t,r)},Zt=s=>"inputs"in s,$n=(s,e,t,n)=>{if(Zt(e)){const r=e.inputs[n];return s.connect(r,t,0),[r,t,0]}return s.connect(e,t,n),[e,t,n]},Mi=(s,e,t)=>{for(const n of s)if(n[0]===e&&n[1]===t)return s.delete(n),n;return null},lc=(s,e,t)=>es(s,n=>n[0]===e&&n[1]===t),Pi=(s,e)=>{if(!fn(s).delete(e))throw new Error("Missing the expected event listener.")},Ni=(s,e,t)=>{const n=Ue(s,e),r=es(n,i=>i[0]===t);return n.size===0&&s.delete(e),r},Un=(s,e,t,n)=>{Zt(e)?s.disconnect(e.inputs[n],t,0):s.disconnect(e,t,n)},K=s=>Ue(Xs,s),cn=s=>Ue(Hs,s),Ct=s=>Es.has(s),On=s=>!jt.has(s),Qr=(s,e)=>new Promise(t=>{if(e!==null)t(!0);else{const n=s.createScriptProcessor(256,1,1),r=s.createGain(),i=s.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const a=s.createBufferSource();a.buffer=i,a.loop=!0,a.connect(n).connect(s.destination),a.connect(r),a.disconnect(r),n.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),n.onaudioprocess=null,a.disconnect(n),n.disconnect(s.destination)},a.start()}}),bs=(s,e)=>{const t=new Map;for(const n of s)for(const r of n){const i=t.get(r);t.set(r,i===void 0?1:i+1)}t.forEach((n,r)=>e(r,n))},zn=s=>"context"in s,uc=s=>{const e=new Map;s.connect=(t=>(n,r=0,i=0)=>{const o=zn(n)?t(n,r,i):t(n,r),a=e.get(n);return a===void 0?e.set(n,[{input:i,output:r}]):a.every(c=>c.input!==i||c.output!==r)&&a.push({input:i,output:r}),o})(s.connect.bind(s)),s.disconnect=(t=>(n,r,i)=>{if(t.apply(s),n===void 0)e.clear();else if(typeof n=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==n);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(n))if(r===void 0)e.delete(n);else{const o=e.get(n);if(o!==void 0){const a=o.filter(c=>c.output!==r&&(c.input!==i||i===void 0));a.length===0?e.delete(n):e.set(n,a)}}for(const[o,a]of e)a.forEach(c=>{zn(o)?s.connect(o,c.output,c.input):s.connect(o,c.output)})})(s.disconnect)},hc=(s,e,t,n)=>{const{activeInputs:r,passiveInputs:i}=gn(e),{outputs:o}=Se(s),a=fn(s),c=l=>{const u=K(s),h=cn(e);if(l){const d=Ni(i,s,t);Hr(r,s,d,!1),!n&&!Ct(s)&&u.connect(h,t)}else{const d=lc(r,s,t);Jr(i,d,!1),!n&&!Ct(s)&&u.disconnect(h,t)}};return St(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),tt(s)?Hr(r,s,[t,c],!0):Jr(i,[s,t,c],!0),!0):!1},dc=(s,e,t,n)=>{const{activeInputs:r,passiveInputs:i}=Se(e),o=Mi(r[n],s,t);return o===null?[Ri(i,s,t,n)[2],!1]:[o[2],!0]},pc=(s,e,t)=>{const{activeInputs:n,passiveInputs:r}=gn(e),i=Mi(n,s,t);return i===null?[Ni(r,s,t)[1],!1]:[i[2],!0]},Qs=(s,e,t,n,r)=>{const[i,o]=dc(s,t,n,r);if(i!==null&&(Pi(s,i),o&&!e&&!Ct(s)&&Un(K(s),K(t),n,r)),tt(t)){const{activeInputs:a}=Se(t);Ms(t,a)}},Ks=(s,e,t,n)=>{const[r,i]=pc(s,t,n);r!==null&&(Pi(s,r),i&&!e&&!Ct(s)&&K(s).disconnect(cn(t),n))},fc=(s,e)=>{const t=Se(s),n=[];for(const r of t.outputs)_n(r)?Qs(s,e,...r):Ks(s,e,...r),n.push(r[0]);return t.outputs.clear(),n},mc=(s,e,t)=>{const n=Se(s),r=[];for(const i of n.outputs)i[1]===t&&(_n(i)?Qs(s,e,...i):Ks(s,e,...i),r.push(i[0]),n.outputs.delete(i));return r},gc=(s,e,t,n,r)=>{const i=Se(s);return Array.from(i.outputs).filter(o=>o[0]===t&&(n===void 0||o[1]===n)&&(r===void 0||o[2]===r)).map(o=>(_n(o)?Qs(s,e,...o):Ks(s,e,...o),i.outputs.delete(o),o[0]))},_c=(s,e,t,n,r,i,o,a,c,l,u,h,d,p,f,m)=>class extends l{constructor(y,b,S,x){super(S),this._context=y,this._nativeAudioNode=S;const _=u(y);h(_)&&t(Qr,()=>Qr(_,m))!==!0&&uc(S),Xs.set(this,S),wi.set(this,new Set),y.state!=="closed"&&b&&Bt(this),s(this,x,S)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,b=0,S=0){if(b<0||b>=this._nativeAudioNode.numberOfOutputs)throw r();const x=u(this._context),_=f(x);if(d(y)||p(y))throw i();if(qn(y)){const v=K(y);try{const A=$n(this._nativeAudioNode,v,b,S),w=On(this);(_||w)&&this._nativeAudioNode.disconnect(...A),this.context.state!=="closed"&&!w&&On(y)&&Bt(y)}catch(A){throw A.code===12?i():A}if(e(this,y,b,S,_)){const A=c([this],y);bs(A,n(_))}return y}const C=cn(y);if(C.name==="playbackRate"&&C.maxValue===1024)throw o();try{this._nativeAudioNode.connect(C,b),(_||On(this))&&this._nativeAudioNode.disconnect(C,b)}catch(v){throw v.code===12?i():v}if(hc(this,y,b,_)){const v=c([this],y);bs(v,n(_))}}disconnect(y,b,S){let x;const _=u(this._context),C=f(_);if(y===void 0)x=fc(this,C);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw r();x=mc(this,C,y)}else{if(b!==void 0&&(b<0||b>=this.numberOfOutputs)||qn(y)&&S!==void 0&&(S<0||S>=y.numberOfInputs))throw r();if(x=gc(this,C,y,b,S),x.length===0)throw i()}for(const T of x){const v=c([this],T);bs(v,a)}}},yc=(s,e,t,n,r,i,o,a,c,l,u,h,d)=>(p,f,m,g=null,y=null)=>{const b=m.value,S=new Ra(b),x=f?n(S):null,_={get defaultValue(){return b},get maxValue(){return g===null?m.maxValue:g},get minValue(){return y===null?m.minValue:y},get value(){return m.value},set value(C){m.value=C,_.setValueAtTime(C,p.context.currentTime)},cancelAndHoldAtTime(C){if(typeof m.cancelAndHoldAtTime=="function")x===null&&S.flush(p.context.currentTime),S.add(r(C)),m.cancelAndHoldAtTime(C);else{const T=Array.from(S).pop();x===null&&S.flush(p.context.currentTime),S.add(r(C));const v=Array.from(S).pop();m.cancelScheduledValues(C),T!==v&&v!==void 0&&(v.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(v.value,v.endTime):v.type==="linearRampToValue"?m.linearRampToValueAtTime(v.value,v.endTime):v.type==="setValue"?m.setValueAtTime(v.value,v.startTime):v.type==="setValueCurve"&&m.setValueCurveAtTime(v.values,v.startTime,v.duration))}return _},cancelScheduledValues(C){return x===null&&S.flush(p.context.currentTime),S.add(i(C)),m.cancelScheduledValues(C),_},exponentialRampToValueAtTime(C,T){if(C===0)throw new RangeError;if(!Number.isFinite(T)||T<0)throw new RangeError;const v=p.context.currentTime;return x===null&&S.flush(v),Array.from(S).length===0&&(S.add(l(b,v)),m.setValueAtTime(b,v)),S.add(o(C,T)),m.exponentialRampToValueAtTime(C,T),_},linearRampToValueAtTime(C,T){const v=p.context.currentTime;return x===null&&S.flush(v),Array.from(S).length===0&&(S.add(l(b,v)),m.setValueAtTime(b,v)),S.add(a(C,T)),m.linearRampToValueAtTime(C,T),_},setTargetAtTime(C,T,v){return x===null&&S.flush(p.context.currentTime),S.add(c(C,T,v)),m.setTargetAtTime(C,T,v),_},setValueAtTime(C,T){return x===null&&S.flush(p.context.currentTime),S.add(l(C,T)),m.setValueAtTime(C,T),_},setValueCurveAtTime(C,T,v){const R=C instanceof Float32Array?C:new Float32Array(C);if(h!==null&&h.name==="webkitAudioContext"){const A=T+v,w=p.context.sampleRate,k=Math.ceil(T*w),I=Math.floor(A*w),O=I-k,F=new Float32Array(O);for(let N=0;N<O;N+=1){const $=(R.length-1)/v*((k+N)/w-T),V=Math.floor($),B=Math.ceil($);F[N]=V===B?R[V]:(1-($-V))*R[V]+(1-(B-$))*R[B]}x===null&&S.flush(p.context.currentTime),S.add(u(F,T,v)),m.setValueCurveAtTime(F,T,v);const P=I/w;P<A&&d(_,F[F.length-1],P),d(_,R[R.length-1],A)}else x===null&&S.flush(p.context.currentTime),S.add(u(R,T,v)),m.setValueCurveAtTime(R,T,v);return _}};return t.set(_,m),e.set(_,p),s(_,x),_},vc=s=>({replay(e){for(const t of s)if(t.type==="exponentialRampToValue"){const{endTime:n,value:r}=t;e.exponentialRampToValueAtTime(r,n)}else if(t.type==="linearRampToValue"){const{endTime:n,value:r}=t;e.linearRampToValueAtTime(r,n)}else if(t.type==="setTarget"){const{startTime:n,target:r,timeConstant:i}=t;e.setTargetAtTime(r,n,i)}else if(t.type==="setValue"){const{startTime:n,value:r}=t;e.setValueAtTime(r,n)}else if(t.type==="setValueCurve"){const{duration:n,startTime:r,values:i}=t;e.setValueCurveAtTime(i,r,n)}else throw new Error("Can't apply an unknown automation.")}});class Di{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,r)=>e.call(t,n,r,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Cc={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},Tc=(s,e,t,n,r,i,o,a,c,l,u,h,d,p)=>class extends e{constructor(m,g,y){var b;const S=a(m),x=c(S),_=u({...Cc,...y});d(_);const C=Os.get(S),T=C==null?void 0:C.get(g),v=x||S.state!=="closed"?S:(b=o(S))!==null&&b!==void 0?b:S,R=r(v,x?null:m.baseLatency,l,g,T,_),A=x?n(g,_,T):null;super(m,!0,R,A);const w=[];R.parameters.forEach((I,O)=>{const F=t(this,x,I);w.push([O,F])}),this._nativeAudioWorkletNode=R,this._onprocessorerror=null,this._parameters=new Di(w),x&&s(S,this);const{activeInputs:k}=i(this);h(R,k)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const g=typeof m=="function"?p(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===g?m:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function Gn(s,e,t,n,r){if(typeof s.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),s.copyFromChannel(e[t],n,r);else{const i=s.getChannelData(n);if(e[t].byteLength===0)e[t]=i.slice(r,r+128);else{const o=new Float32Array(i.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const Fi=(s,e,t,n,r)=>{typeof s.copyToChannel=="function"?e[t].byteLength!==0&&s.copyToChannel(e[t],n,r):e[t].byteLength!==0&&s.getChannelData(n).set(e[t],r)},Yn=(s,e)=>{const t=[];for(let n=0;n<s;n+=1){const r=[],i=typeof e=="number"?e:e[n];for(let o=0;o<i;o+=1)r.push(new Float32Array(128));t.push(r)}return t},bc=(s,e)=>{const t=Ue(Is,s),n=K(e);return Ue(t,n)},Sc=async(s,e,t,n,r,i,o)=>{const a=e===null?Math.ceil(s.context.length/128)*128:e.length,c=n.channelCount*n.numberOfInputs,l=r.reduce((g,y)=>g+y,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const h=Se(s),d=await bc(t,s),p=Yn(n.numberOfInputs,n.channelCount),f=Yn(n.numberOfOutputs,r),m=Array.from(s.parameters.keys()).reduce((g,y)=>({...g,[y]:new Float32Array(128)}),{});for(let g=0;g<a;g+=128){if(n.numberOfInputs>0&&e!==null)for(let y=0;y<n.numberOfInputs;y+=1)for(let b=0;b<n.channelCount;b+=1)Gn(e,p[y],b,b,g);i.parameterDescriptors!==void 0&&e!==null&&i.parameterDescriptors.forEach(({name:y},b)=>{Gn(e,m,y,c+b,g)});for(let y=0;y<n.numberOfInputs;y+=1)for(let b=0;b<r[y];b+=1)f[y][b].byteLength===0&&(f[y][b]=new Float32Array(128));try{const y=p.map((S,x)=>h.activeInputs[x].size===0?[]:S),b=o(g/t.sampleRate,t.sampleRate,()=>d.process(y,f,m));if(u!==null)for(let S=0,x=0;S<n.numberOfOutputs;S+=1){for(let _=0;_<r[S];_+=1)Fi(u,f[S],_,x+_,g);x+=r[S]}if(!b)break}catch(y){s.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},kc=(s,e,t,n,r,i,o,a,c,l,u,h,d,p,f,m)=>(g,y,b)=>{const S=new WeakMap;let x=null;const _=async(C,T)=>{let v=u(C),R=null;const A=Ce(v,T),w=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){const k=w.reduce((P,N)=>P+N,0),I=r(T,{channelCount:Math.max(1,k),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,k)}),O=[];for(let P=0;P<C.numberOfOutputs;P+=1)O.push(n(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:w[P]}));const F=o(T,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});F.connect=e.bind(null,O),F.disconnect=c.bind(null,O),R=[I,O,F]}else A||(v=new h(T,g));if(S.set(T,R===null?v:R[2]),R!==null){if(x===null){if(b===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const N=C.channelCount*C.numberOfInputs,$=b.parameterDescriptors===void 0?0:b.parameterDescriptors.length,V=N+$;x=Sc(C,V===0?null:await(async()=>{const j=new d(V,Math.ceil(C.context.length/128)*128,T.sampleRate),Z=[],Ee=[];for(let ee=0;ee<y.numberOfInputs;ee+=1)Z.push(o(j,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),Ee.push(r(j,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const Oe=await Promise.all(Array.from(C.parameters.values()).map(async ee=>{const Te=i(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ee.value});return await p(j,ee,Te.offset),Te})),z=n(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,N+$)});for(let ee=0;ee<y.numberOfInputs;ee+=1){Z[ee].connect(Ee[ee]);for(let Te=0;Te<y.channelCount;Te+=1)Ee[ee].connect(z,Te,ee*y.channelCount+Te)}for(const[ee,Te]of Oe.entries())Te.connect(z,0,N+ee),Te.start(0);return z.connect(j.destination),await Promise.all(Z.map(ee=>f(C,j,ee))),m(j)})(),T,y,w,b,l)}const k=await x,I=t(T,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[O,F,P]=R;k!==null&&(I.buffer=k,I.start(0)),I.connect(O);for(let N=0,$=0;N<C.numberOfOutputs;N+=1){const V=F[N];for(let B=0;B<w[N];B+=1)O.connect(V,$+B,B);$+=w[N]}return P}if(A)for(const[k,I]of C.parameters.entries())await s(T,I,v.parameters.get(k));else for(const[k,I]of C.parameters.entries())await p(T,I,v.parameters.get(k));return await f(C,T,v),v};return{render(C,T){a(T,C);const v=S.get(T);return v!==void 0?Promise.resolve(v):_(C,T)}}},xc=(s,e,t,n,r,i,o,a,c,l,u,h,d,p,f,m,g,y,b,S)=>class extends f{constructor(_,C){super(_,C),this._nativeContext=_,this._audioWorklet=s===void 0?void 0:{addModule:(T,v)=>s(this,T,v)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new r(this)}createBuffer(_,C,T){return new t({length:C,numberOfChannels:_,sampleRate:T})}createBufferSource(){return new n(this)}createChannelMerger(_=6){return new i(this,{numberOfInputs:_})}createChannelSplitter(_=6){return new o(this,{numberOfOutputs:_})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(_=1){return new u(this,{maxDelayTime:_})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(_,C){return new p(this,{feedback:C,feedforward:_})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(_,C,T={disableNormalization:!1}){return new y(this,{...T,imag:C,real:_})}createStereoPanner(){return new b(this)}createWaveShaper(){return new S(this)}decodeAudioData(_,C,T){return l(this._nativeContext,_).then(v=>(typeof C=="function"&&C(v),v),v=>{throw typeof T=="function"&&T(v),v})}},wc={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Ac=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const h=i(l),d={...wc,...u},p=r(h,d),f=o(h),m=f?t():null;super(l,!1,p,m),this._Q=e(this,f,p.Q,be,Ie),this._detune=e(this,f,p.detune,1200*Math.log2(be),-1200*Math.log2(be)),this._frequency=e(this,f,p.frequency,l.sampleRate/2,0),this._gain=e(this,f,p.gain,40*Math.log10(be),Ie),this._nativeBiquadFilterNode=p,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?n():d}if(l.length!==u.length||u.length!==h.length)throw n()}},Rc=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ce(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return i.set(c,l),u?(await s(c,a.Q,l.Q),await s(c,a.detune,l.detune),await s(c,a.frequency,l.frequency),await s(c,a.gain,l.gain)):(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Ec=(s,e)=>(t,n)=>{const r=e.get(t);if(r!==void 0)return r;const i=s.get(t);if(i!==void 0)return i;try{const o=n();return o instanceof Promise?(s.set(t,o),o.catch(()=>!1).then(a=>(s.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},Oc={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Ic=(s,e,t,n,r)=>class extends s{constructor(o,a){const c=n(o),l={...Oc,...a},u=t(c,l),h=r(c)?e():null;super(o,!1,u,h)}},Mc=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!Ce(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=s(o,l)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},Pc={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Nc=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=n(a),u=i({...Pc,...c}),h=t(l,u),d=r(l)?e():null;super(a,!1,h,d)}},Dc=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!Ce(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=s(o,l)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},Fc=s=>(e,t,n)=>s(t,e,n),Vc=s=>(e,t,n=0,r=0)=>{const i=e[n];if(i===void 0)throw s();return zn(t)?i.connect(t,0,r):i.connect(t,0)},Lc=s=>(e,t)=>{const n=s(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=e.createBuffer(1,2,44100);return n.buffer=r,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}},jc={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Bc=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),h={...jc,...l},d=n(u,h),p=i(u),f=p?t():null;super(c,!1,d,f),this._constantSourceNodeRenderer=f,this._nativeConstantSourceNode=d,this._offset=e(this,p,d.offset,be,Ie),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){Bt(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),tt(this)&&mn(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},Wc=(s,e,t,n,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=Ce(h,u);if(!d){const p={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,p),o!==null&&h.start(o),a!==null&&h.stop(a)}return i.set(u,h),d?await s(u,l.offset,h.offset):await n(u,l.offset,h.offset),await r(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=i.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},qc=s=>e=>(s[0]=e,s[0]),$c={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Uc=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=n(a),u={...$c,...c},h=t(l,u),p=r(l)?e():null;super(a,!1,h,p),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&i(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},zc=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!Ce(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=s(o,l)}return n.set(o,a),Zt(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},Gc=(s,e)=>(t,n,r)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,r)}catch(i){throw i.name==="SyntaxError"?s():i}},Yc=()=>new DOMException("","DataCloneError"),Kr=s=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const r=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>r();try{e.postMessage(s,[s])}catch{}finally{r()}})},Zc=(s,e,t,n,r,i,o,a,c,l,u)=>(h,d)=>{const p=o(h)?h:i(h);if(r.has(d)){const f=t();return Promise.reject(f)}try{r.add(d)}catch{}return e(c,()=>c(p))?p.decodeAudioData(d).then(f=>(Kr(d).catch(()=>{}),e(a,()=>a(f))||u(f),s.add(f),f)):new Promise((f,m)=>{const g=async()=>{try{await Kr(d)}catch{}},y=b=>{m(b),g()};try{p.decodeAudioData(d,b=>{typeof b.copyFromChannel!="function"&&(l(b),Js(b)),s.add(b),g().then(()=>f(b))},b=>{y(b===null?n():b)})}catch(b){y(b)}})},Xc=(s,e,t,n,r,i,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=i(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const p=n(c),{outputs:f}=t(c);for(const m of f)if(_n(m)){const g=n(m[0]);s(p,g,m[1],m[2])}else{const g=r(m[0]);p.connect(g,m[1])}}}else e.set(c,u-l)},Hc={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Jc=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),h={...Hc,...l},d=n(u,h),p=i(u),f=p?t(h.maxDelayTime):null;super(c,!1,d,f),this._delayTime=e(this,p,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},Qc=(s,e,t,n,r)=>i=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=Ce(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:i};u=e(l,d)}return o.set(l,u),h?await s(l,c.delayTime,u.delayTime):await n(l,c.delayTime,u.delayTime),await r(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},Kc=s=>(e,t,n,r)=>s(e[r],i=>i[0]===t&&i[1]===n),el=s=>(e,t)=>{s(e).delete(t)},tl=s=>"delayTime"in s,nl=(s,e,t)=>function n(r,i){const o=qn(i)?i:t(s,i);if(tl(o))return[];if(r[0]===o)return[r];if(r.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>n([...r,o],c[0])).reduce((c,l)=>c.concat(l),[])},An=(s,e,t)=>{const n=e[t];if(n===void 0)throw s();return n},sl=s=>(e,t=void 0,n=void 0,r=0)=>t===void 0?e.forEach(i=>i.disconnect()):typeof t=="number"?An(s,e,t).disconnect():zn(t)?n===void 0?e.forEach(i=>i.disconnect(t)):r===void 0?An(s,e,n).disconnect(t,0):An(s,e,n).disconnect(t,0,r):n===void 0?e.forEach(i=>i.disconnect(t)):An(s,e,n).disconnect(t,0),rl={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},il=(s,e,t,n,r,i,o,a)=>class extends s{constructor(l,u){const h=i(l),d={...rl,...u},p=n(h,d),f=o(h),m=f?t():null;super(l,!1,p,m),this._attack=e(this,f,p.attack),this._knee=e(this,f,p.knee),this._nativeDynamicsCompressorNode=p,this._ratio=e(this,f,p.ratio),this._release=e(this,f,p.release),this._threshold=e(this,f,p.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,r()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,r()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},ol=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ce(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return i.set(c,l),u?(await s(c,a.attack,l.attack),await s(c,a.knee,l.knee),await s(c,a.ratio,l.ratio),await s(c,a.release,l.release),await s(c,a.threshold,l.threshold)):(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},al=()=>new DOMException("","EncodingError"),cl=s=>e=>new Promise((t,n)=>{if(s===null){n(new SyntaxError);return}const r=s.document.head;if(r===null)n(new SyntaxError);else{const i=s.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=s.onerror,l=()=>{s.onerror=c,URL.revokeObjectURL(a)};s.onerror=(u,h,d,p,f)=>{if(h===a||h===s.location.href&&d===1&&p===1)return l(),n(f),!1;if(c!==null)return c(u,h,d,p,f)},i.onerror=()=>{l(),n(new SyntaxError)},i.onload=()=>{l(),t()},i.src=a,i.type="module",r.appendChild(i)}}),ll=s=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,r){if(n!==null){let i=this._listeners.get(n);i===void 0&&(i=s(this,n),typeof n=="function"&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(t,i,r)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,r){const i=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,i===void 0?null:i,r)}},ul=s=>(e,t,n)=>{Object.defineProperties(s,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{s!==null&&(delete s.currentFrame,delete s.currentTime)}},hl=s=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw s()},dl={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},pl=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=r(a),u={...dl,...c},h=n(l,u),d=i(l),p=d?t():null;super(a,!1,h,p),this._gain=e(this,d,h.gain,be,Ie)}get gain(){return this._gain}},fl=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ce(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return i.set(c,l),u?await s(c,a.gain,l.gain):await n(c,a.gain,l.gain),await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},ml=(s,e)=>t=>e(s,t),gl=s=>e=>{const t=s(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},_l=s=>e=>{var t;return(t=s.get(e))!==null&&t!==void 0?t:0},yl=s=>e=>{const t=s(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},vl=s=>e=>s.get(e),me=()=>new DOMException("","InvalidStateError"),Cl=s=>e=>{const t=s.get(e);if(t===void 0)throw me();return t},Tl=(s,e)=>t=>{let n=s.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),s.set(t,n),n},bl=s=>e=>{const t=s.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},ts=()=>new DOMException("","InvalidAccessError"),Sl=s=>{s.getFrequencyResponse=(e=>(t,n,r)=>{if(t.length!==n.length||n.length!==r.length)throw ts();return e.call(s,t,n,r)})(s.getFrequencyResponse)},kl={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},xl=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=n(a),u=r(l),h={...kl,...c},d=e(l,u?null:a.baseLatency,h),p=u?t(h.feedback,h.feedforward):null;super(a,!1,d,p),Sl(d),this._nativeIIRFilterNode=d,i(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},Vi=(s,e,t,n,r,i,o,a,c,l,u)=>{const h=l.length;let d=a;for(let p=0;p<h;p+=1){let f=t[0]*l[p];for(let m=1;m<r;m+=1){const g=d-m&c-1;f+=t[m]*i[g],f-=s[m]*o[g]}for(let m=r;m<n;m+=1)f+=t[m]*i[d-m&c-1];for(let m=r;m<e;m+=1)f-=s[m]*o[d-m&c-1];i[d]=l[p],o[d]=f,d=d+1&c-1,u[p]=f}return d},wl=(s,e,t,n)=>{const r=t instanceof Float64Array?t:new Float64Array(t),i=n instanceof Float64Array?n:new Float64Array(n),o=r.length,a=i.length,c=Math.min(o,a);if(r[0]!==1){for(let f=0;f<o;f+=1)i[f]/=r[0];for(let f=1;f<a;f+=1)r[f]/=r[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(s.numberOfChannels,s.length,s.sampleRate),p=s.numberOfChannels;for(let f=0;f<p;f+=1){const m=s.getChannelData(f),g=d.getChannelData(f);u.fill(0),h.fill(0),Vi(r,o,i,a,c,u,h,0,l,m,g)}return d},Al=(s,e,t,n,r)=>(i,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,p=e(u);const f=Ce(p,h);if(h.createIIRFilter===void 0?d=s(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(p=h.createIIRFilter(o,i)),a.set(h,d===null?p:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await n(u,g,g.destination);const y=await r(g);return wl(y,h,i,o)})()}const m=await c;return d.buffer=m,d.start(0),d}return await n(u,h,p),p};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Rl=(s,e,t,n,r,i)=>o=>(a,c)=>{const l=s.get(a);if(l===void 0){if(!o&&i(a)){const u=n(a),{outputs:h}=t(a);for(const d of h)if(_n(d)){const p=n(d[0]);e(u,p,d[1],d[2])}else{const p=r(d[0]);u.disconnect(p,d[1])}}s.set(a,c)}else s.set(a,l+c)},El=(s,e)=>t=>{const n=s.get(t);return e(n)||e(t)},Ol=(s,e)=>t=>s.has(t)||e(t),Il=(s,e)=>t=>s.has(t)||e(t),Ml=(s,e)=>t=>{const n=s.get(t);return e(n)||e(t)},Pl=s=>e=>s!==null&&e instanceof s,Nl=s=>e=>s!==null&&typeof s.AudioNode=="function"&&e instanceof s.AudioNode,Dl=s=>e=>s!==null&&typeof s.AudioParam=="function"&&e instanceof s.AudioParam,Fl=(s,e)=>t=>s(t)||e(t),Vl=s=>e=>s!==null&&e instanceof s,Ll=s=>s!==null&&s.isSecureContext,jl=(s,e,t,n)=>class extends s{constructor(i,o){const a=t(i),c=e(a,o);if(n(a))throw TypeError();super(i,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Bl={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Wl=(s,e,t,n)=>class extends s{constructor(i,o){const a=t(i);if(n(a))throw new TypeError;const c={...Bl,...o},l=e(a,c);super(i,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},ql=(s,e,t,n)=>class extends s{constructor(i,o){const a=t(i),c=e(a,o);if(n(a))throw new TypeError;super(i,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},$l=(s,e,t)=>class extends s{constructor(r,i){const o=t(r),a=e(o,i);super(r,!0,a,null)}},Ul=(s,e,t,n,r,i)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,Kn.set(this,a),n(a)&&r.set(a,new Set),this._destination=new s(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?i(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},ln=s=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=s.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},zl=(s,e)=>(t,n,r)=>{const i=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=i.size===0;if(e(a))return o.call(t,a,c,l),s(i,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&n(),a;o.call(t,a,c),s(i,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&n()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=i.size>0;if(a===void 0)o.apply(t),i.clear();else if(typeof a=="number"){o.call(t,a);for(const d of i)d[1]===a&&i.delete(d)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const d of i)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&i.delete(d)}const h=i.size===0;u&&h&&r()})(t.disconnect),t},te=(s,e,t)=>{const n=e[t];n!==void 0&&n!==s[t]&&(s[t]=n)},pe=(s,e)=>{te(s,e,"channelCount"),te(s,e,"channelCountMode"),te(s,e,"channelInterpretation")},ei=s=>typeof s.getFloatTimeDomainData=="function",Gl=s=>{s.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);s.getByteTimeDomainData(t);const n=Math.max(t.length,s.fftSize);for(let r=0;r<n;r+=1)e[r]=(t[r]-128)*.0078125;return e}},Yl=(s,e)=>(t,n)=>{const r=t.createAnalyser();if(pe(r,n),!(n.maxDecibels>n.minDecibels))throw e();return te(r,n,"fftSize"),te(r,n,"maxDecibels"),te(r,n,"minDecibels"),te(r,n,"smoothingTimeConstant"),s(ei,()=>ei(r))||Gl(r),r},Zl=s=>s===null?null:s.hasOwnProperty("AudioBuffer")?s.AudioBuffer:null,oe=(s,e,t)=>{const n=e[t];n!==void 0&&n!==s[t].value&&(s[t].value=n)},Xl=s=>{s.start=(e=>{let t=!1;return(n=0,r=0,i)=>{if(t)throw me();e.call(s,n,r,i),t=!0}})(s.start)},er=s=>{s.start=(e=>(t=0,n=0,r)=>{if(typeof r=="number"&&r<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(s,t,n,r)})(s.start)},tr=s=>{s.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(s,t)})(s.stop)},Hl=(s,e,t,n,r,i,o,a,c,l,u)=>(h,d)=>{const p=h.createBufferSource();return pe(p,d),oe(p,d,"playbackRate"),te(p,d,"buffer"),te(p,d,"loop"),te(p,d,"loopEnd"),te(p,d,"loopStart"),e(t,()=>t(h))||Xl(p),e(n,()=>n(h))||c(p),e(r,()=>r(h))||l(p,h),e(i,()=>i(h))||er(p),e(o,()=>o(h))||u(p,h),e(a,()=>a(h))||tr(p),s(h,p),p},Jl=s=>s===null?null:s.hasOwnProperty("AudioContext")?s.AudioContext:s.hasOwnProperty("webkitAudioContext")?s.webkitAudioContext:null,Ql=(s,e)=>(t,n,r)=>{const i=t.destination;if(i.channelCount!==n)try{i.channelCount=n}catch{}r&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:n});const o=s(t,{channelCount:n,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{i.channelCount=c}catch(l){if(c>i.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},Kl=s=>s===null?null:s.hasOwnProperty("AudioWorkletNode")?s.AudioWorkletNode:null,eu=s=>{const{port1:e}=new MessageChannel;try{e.postMessage(s)}finally{e.close()}},tu=(s,e,t,n,r)=>(i,o,a,c,l,u)=>{if(a!==null)try{const h=new a(i,c,u),d=new Map;let p=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw s()}},channelCountMode:{get:()=>"explicit",set:()=>{throw s()}},onprocessorerror:{get:()=>p,set:f=>{typeof p=="function"&&h.removeEventListener("processorerror",p),p=typeof f=="function"?f:null,typeof p=="function"&&h.addEventListener("processorerror",p)}}}),h.addEventListener=(f=>(...m)=>{if(m[0]==="processorerror"){const g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){const y=d.get(m[1]);y!==void 0?m[1]=y:(m[1]=b=>{b.type==="error"?(Object.defineProperties(b,{type:{value:"processorerror"}}),g(b)):g(new ErrorEvent(m[0],{...b}))},d.set(g,m[1]))}}return f.call(h,"error",m[1],m[2]),f.call(h,...m)})(h.addEventListener),h.removeEventListener=(f=>(...m)=>{if(m[0]==="processorerror"){const g=d.get(m[1]);g!==void 0&&(d.delete(m[1]),m[1]=g)}return f.call(h,"error",m[1],m[2]),f.call(h,m[0],m[1],m[2])})(h.removeEventListener),u.numberOfOutputs!==0){const f=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(f).connect(i.destination),r(h,()=>f.disconnect(),()=>f.connect(i.destination))}return h}catch(h){throw h.code===11?n():h}if(l===void 0)throw n();return eu(u),e(i,o,l,u)},Li=(s,e)=>s===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(s*e))))),nu=s=>new Promise((e,t)=>{const{port1:n,port2:r}=new MessageChannel;n.onmessage=({data:i})=>{n.close(),r.close(),e(i)},n.onmessageerror=({data:i})=>{n.close(),r.close(),t(i)},r.postMessage(s)}),su=async(s,e)=>{const t=await nu(e);return new s(t)},ru=(s,e,t,n)=>{let r=Is.get(s);r===void 0&&(r=new WeakMap,Is.set(s,r));const i=su(t,n);return r.set(e,i),i},iu=(s,e,t,n,r,i,o,a,c,l,u,h,d)=>(p,f,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();const y=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(y.some(E=>E<1))throw c();if(y.length!==g.numberOfOutputs)throw e();if(g.channelCountMode!=="explicit")throw c();const b=g.channelCount*g.numberOfInputs,S=y.reduce((E,L)=>E+L,0),x=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(b+x>6||S>6)throw c();const _=new MessageChannel,C=[],T=[];for(let E=0;E<g.numberOfInputs;E+=1)C.push(o(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(r(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const v=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:E,maxValue:L,minValue:de,name:ne}of m.parameterDescriptors){const Y=i(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[ne]!==void 0?g.parameterData[ne]:E===void 0?0:E});Object.defineProperties(Y.offset,{defaultValue:{get:()=>E===void 0?0:E},maxValue:{get:()=>L===void 0?be:L},minValue:{get:()=>de===void 0?Ie:de}}),v.push(Y)}const R=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,b+x)}),A=Li(f,p.sampleRate),w=a(p,A,b+x,Math.max(1,S)),k=r(p,{channelCount:Math.max(1,S),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,S)}),I=[];for(let E=0;E<g.numberOfOutputs;E+=1)I.push(n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[E]}));for(let E=0;E<g.numberOfInputs;E+=1){C[E].connect(T[E]);for(let L=0;L<g.channelCount;L+=1)T[E].connect(R,L,E*g.channelCount+L)}const O=new Di(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:E},L)=>{const de=v[L];return de.connect(R,0,b+L),de.start(0),[E,de.offset]}));R.connect(w);let F=g.channelInterpretation,P=null;const N=g.numberOfOutputs===0?[w]:I,$={get bufferSize(){return A},get channelCount(){return g.channelCount},set channelCount(E){throw t()},get channelCountMode(){return g.channelCountMode},set channelCountMode(E){throw t()},get channelInterpretation(){return F},set channelInterpretation(E){for(const L of C)L.channelInterpretation=E;F=E},get context(){return w.context},get inputs(){return C},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return P},set onprocessorerror(E){typeof P=="function"&&$.removeEventListener("processorerror",P),P=typeof E=="function"?E:null,typeof P=="function"&&$.addEventListener("processorerror",P)},get parameters(){return O},get port(){return _.port2},addEventListener(...E){return w.addEventListener(E[0],E[1],E[2])},connect:s.bind(null,N),disconnect:l.bind(null,N),dispatchEvent(...E){return w.dispatchEvent(E[0])},removeEventListener(...E){return w.removeEventListener(E[0],E[1],E[2])}},V=new Map;_.port1.addEventListener=(E=>(...L)=>{if(L[0]==="message"){const de=typeof L[1]=="function"?L[1]:typeof L[1]=="object"&&L[1]!==null&&typeof L[1].handleEvent=="function"?L[1].handleEvent:null;if(de!==null){const ne=V.get(L[1]);ne!==void 0?L[1]=ne:(L[1]=Y=>{u(p.currentTime,p.sampleRate,()=>de(Y))},V.set(de,L[1]))}}return E.call(_.port1,L[0],L[1],L[2])})(_.port1.addEventListener),_.port1.removeEventListener=(E=>(...L)=>{if(L[0]==="message"){const de=V.get(L[1]);de!==void 0&&(V.delete(L[1]),L[1]=de)}return E.call(_.port1,L[0],L[1],L[2])})(_.port1.removeEventListener);let B=null;Object.defineProperty(_.port1,"onmessage",{get:()=>B,set:E=>{typeof B=="function"&&_.port1.removeEventListener("message",B),B=typeof E=="function"?E:null,typeof B=="function"&&(_.port1.addEventListener("message",B),_.port1.start())}}),m.prototype.port=_.port1;let j=null;ru(p,$,m,g).then(E=>j=E);const Ee=Yn(g.numberOfInputs,g.channelCount),Oe=Yn(g.numberOfOutputs,y),z=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((E,{name:L})=>({...E,[L]:new Float32Array(128)}),{});let ee=!0;const Te=()=>{g.numberOfOutputs>0&&w.disconnect(k);for(let E=0,L=0;E<g.numberOfOutputs;E+=1){const de=I[E];for(let ne=0;ne<y[E];ne+=1)k.disconnect(de,L+ne,ne);L+=y[E]}},D=new Map;w.onaudioprocess=({inputBuffer:E,outputBuffer:L})=>{if(j!==null){const de=h($);for(let ne=0;ne<A;ne+=128){for(let Y=0;Y<g.numberOfInputs;Y+=1)for(let re=0;re<g.channelCount;re+=1)Gn(E,Ee[Y],re,re,ne);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:Y},re)=>{Gn(E,z,Y,b+re,ne)});for(let Y=0;Y<g.numberOfInputs;Y+=1)for(let re=0;re<y[Y];re+=1)Oe[Y][re].byteLength===0&&(Oe[Y][re]=new Float32Array(128));try{const Y=Ee.map((Ne,ot)=>{if(de[ot].size>0)return D.set(ot,A/128),Ne;const ys=D.get(ot);return ys===void 0?[]:(Ne.every(_a=>_a.every(ya=>ya===0))&&(ys===1?D.delete(ot):D.set(ot,ys-1)),Ne)});ee=u(p.currentTime+ne/p.sampleRate,p.sampleRate,()=>j.process(Y,Oe,z));for(let Ne=0,ot=0;Ne<g.numberOfOutputs;Ne+=1){for(let tn=0;tn<y[Ne];tn+=1)Fi(L,Oe[Ne],tn,ot+tn,ne);ot+=y[Ne]}}catch(Y){ee=!1,$.dispatchEvent(new ErrorEvent("processorerror",{colno:Y.colno,filename:Y.filename,lineno:Y.lineno,message:Y.message}))}if(!ee){for(let Y=0;Y<g.numberOfInputs;Y+=1){C[Y].disconnect(T[Y]);for(let re=0;re<g.channelCount;re+=1)T[ne].disconnect(R,re,Y*g.channelCount+re)}if(m.parameterDescriptors!==void 0){const Y=m.parameterDescriptors.length;for(let re=0;re<Y;re+=1){const Ne=v[re];Ne.disconnect(R,0,b+re),Ne.stop()}}R.disconnect(w),w.onaudioprocess=null,gt?Te():Ot();break}}}};let gt=!1;const _t=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Et=()=>w.connect(_t).connect(p.destination),Ot=()=>{w.disconnect(_t),_t.disconnect()},ma=()=>{if(ee){Ot(),g.numberOfOutputs>0&&w.connect(k);for(let E=0,L=0;E<g.numberOfOutputs;E+=1){const de=I[E];for(let ne=0;ne<y[E];ne+=1)k.connect(de,L+ne,ne);L+=y[E]}}gt=!0},ga=()=>{ee&&(Et(),Te()),gt=!1};return Et(),d($,ma,ga)},ji=(s,e)=>{const t=s.createBiquadFilter();return pe(t,e),oe(t,e,"Q"),oe(t,e,"detune"),oe(t,e,"frequency"),oe(t,e,"gain"),te(t,e,"type"),t},ou=(s,e)=>(t,n)=>{const r=t.createChannelMerger(n.numberOfInputs);return s!==null&&s.name==="webkitAudioContext"&&e(t,r),pe(r,n),r},au=s=>{const e=s.numberOfOutputs;Object.defineProperty(s,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw me()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw me()}}),Object.defineProperty(s,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw me()}})},yn=(s,e)=>{const t=s.createChannelSplitter(e.numberOfOutputs);return pe(t,e),au(t),t},cu=(s,e,t,n,r)=>(i,o)=>{if(i.createConstantSource===void 0)return t(i,o);const a=i.createConstantSource();return pe(a,o),oe(a,o,"offset"),e(n,()=>n(i))||er(a),e(r,()=>r(i))||tr(a),s(i,a),a},Xt=(s,e)=>(s.connect=e.connect.bind(e),s.disconnect=e.disconnect.bind(e),s),lu=(s,e,t,n)=>(r,{offset:i,...o})=>{const a=r.createBuffer(1,2,44100),c=e(r,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(r,{...o,gain:i}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(f){l.channelCount=f},get channelCountMode(){return l.channelCountMode},set channelCountMode(f){l.channelCountMode=f},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(f){l.channelInterpretation=f},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(f){c.onended=f},addEventListener(...f){return c.addEventListener(f[0],f[1],f[2])},dispatchEvent(...f){return c.dispatchEvent(f[0])},removeEventListener(...f){return c.removeEventListener(f[0],f[1],f[2])},start(f=0){c.start.call(c,f)},stop(f=0){c.stop.call(c,f)}},d=()=>c.connect(l),p=()=>c.disconnect(l);return s(r,c),n(Xt(h,l),d,p)},uu=(s,e)=>(t,n)=>{const r=t.createConvolver();if(pe(r,n),n.disableNormalization===r.normalize&&(r.normalize=!n.disableNormalization),te(r,n,"buffer"),n.channelCount>2||(e(r,"channelCount",i=>()=>i.call(r),i=>o=>{if(o>2)throw s();return i.call(r,o)}),n.channelCountMode==="max"))throw s();return e(r,"channelCountMode",i=>()=>i.call(r),i=>o=>{if(o==="max")throw s();return i.call(r,o)}),r},Bi=(s,e)=>{const t=s.createDelay(e.maxDelayTime);return pe(t,e),oe(t,e,"delayTime"),t},hu=s=>(e,t)=>{const n=e.createDynamicsCompressor();if(pe(n,t),t.channelCount>2||t.channelCountMode==="max")throw s();return oe(n,t,"attack"),oe(n,t,"knee"),oe(n,t,"ratio"),oe(n,t,"release"),oe(n,t,"threshold"),n},Re=(s,e)=>{const t=s.createGain();return pe(t,e),oe(t,e,"gain"),t},du=s=>(e,t,n)=>{if(e.createIIRFilter===void 0)return s(e,t,n);const r=e.createIIRFilter(n.feedforward,n.feedback);return pe(r,n),r};function pu(s,e){const t=e[0]*e[0]+e[1]*e[1];return[(s[0]*e[0]+s[1]*e[1])/t,(s[1]*e[0]-s[0]*e[1])/t]}function fu(s,e){return[s[0]*e[0]-s[1]*e[1],s[0]*e[1]+s[1]*e[0]]}function ti(s,e){let t=[0,0];for(let n=s.length-1;n>=0;n-=1)t=fu(t,e),t[0]+=s[n];return t}const mu=(s,e,t,n)=>(r,i,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Li(i,r.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),p=u instanceof Float64Array?u:new Float64Array(u),f=d.length,m=p.length,g=Math.min(f,m);if(f===0||f>20)throw n();if(d[0]===0)throw e();if(m===0||m>20)throw n();if(p[0]===0)throw e();if(d[0]!==1){for(let v=0;v<m;v+=1)p[v]/=d[0];for(let v=1;v<f;v+=1)d[v]/=d[0]}const y=t(r,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=c;const b=32,S=[],x=[],_=[];for(let v=0;v<o;v+=1){S.push(0);const R=new Float32Array(b),A=new Float32Array(b);R.fill(0),A.fill(0),x.push(R),_.push(A)}y.onaudioprocess=v=>{const R=v.inputBuffer,A=v.outputBuffer,w=R.numberOfChannels;for(let k=0;k<w;k+=1){const I=R.getChannelData(k),O=A.getChannelData(k);S[k]=Vi(d,f,p,m,g,x[k],_[k],S[k],b,I,O)}};const C=r.sampleRate/2;return Xt({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(v){y.channelCount=v},get channelCountMode(){return y.channelCountMode},set channelCountMode(v){y.channelCountMode=v},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(v){y.channelInterpretation=v},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...v){return y.addEventListener(v[0],v[1],v[2])},dispatchEvent(...v){return y.dispatchEvent(v[0])},getFrequencyResponse(v,R,A){if(v.length!==R.length||R.length!==A.length)throw s();const w=v.length;for(let k=0;k<w;k+=1){const I=-Math.PI*(v[k]/C),O=[Math.cos(I),Math.sin(I)],F=ti(p,O),P=ti(d,O),N=pu(F,P);R[k]=Math.sqrt(N[0]*N[0]+N[1]*N[1]),A[k]=Math.atan2(N[1],N[0])}},removeEventListener(...v){return y.removeEventListener(v[0],v[1],v[2])}},y)},gu=(s,e)=>s.createMediaElementSource(e.mediaElement),_u=(s,e)=>{const t=s.createMediaStreamDestination();return pe(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},yu=(s,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const n=t.slice(0,1),r=s.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(r,"mediaStream",{value:e}),r},vu=(s,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);const r=new MediaStream([n]),i=t.createMediaStreamSource(r);if(n.kind!=="audio")throw s();if(e(t))throw new TypeError;return i},Cu=s=>s===null?null:s.hasOwnProperty("OfflineAudioContext")?s.OfflineAudioContext:s.hasOwnProperty("webkitOfflineAudioContext")?s.webkitOfflineAudioContext:null,Tu=(s,e,t,n,r,i)=>(o,a)=>{const c=o.createOscillator();return pe(c,a),oe(c,a,"detune"),oe(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):te(c,a,"type"),e(t,()=>t(o))||er(c),e(n,()=>n(o))||i(c,o),e(r,()=>r(o))||tr(c),s(o,c),c},bu=s=>(e,t)=>{const n=e.createPanner();return n.orientationX===void 0?s(e,t):(pe(n,t),oe(n,t,"orientationX"),oe(n,t,"orientationY"),oe(n,t,"orientationZ"),oe(n,t,"positionX"),oe(n,t,"positionY"),oe(n,t,"positionZ"),te(n,t,"coneInnerAngle"),te(n,t,"coneOuterAngle"),te(n,t,"coneOuterGain"),te(n,t,"distanceModel"),te(n,t,"maxDistance"),te(n,t,"panningModel"),te(n,t,"refDistance"),te(n,t,"rolloffFactor"),n)},Su=(s,e,t,n,r,i,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:p,distanceModel:f,maxDistance:m,orientationX:g,orientationY:y,orientationZ:b,panningModel:S,positionX:x,positionY:_,positionZ:C,refDistance:T,rolloffFactor:v,...R})=>{const A=u.createPanner();if(R.channelCount>2||R.channelCountMode==="max")throw o();pe(A,R);const w={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},k=t(u,{...w,channelInterpretation:"speakers",numberOfInputs:6}),I=n(u,{...R,gain:1}),O=n(u,{...w,gain:1}),F=n(u,{...w,gain:0}),P=n(u,{...w,gain:0}),N=n(u,{...w,gain:0}),$=n(u,{...w,gain:0}),V=n(u,{...w,gain:0}),B=r(u,256,6,1),j=i(u,{...w,curve:new Float32Array([1,1]),oversample:"none"});let Z=[g,y,b],Ee=[x,_,C];const Oe=new Float32Array(1);B.onaudioprocess=({inputBuffer:D})=>{const gt=[c(D,Oe,0),c(D,Oe,1),c(D,Oe,2)];gt.some((Et,Ot)=>Et!==Z[Ot])&&(A.setOrientation(...gt),Z=gt);const _t=[c(D,Oe,3),c(D,Oe,4),c(D,Oe,5)];_t.some((Et,Ot)=>Et!==Ee[Ot])&&(A.setPosition(..._t),Ee=_t)},Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0});const z={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(D){if(D>2)throw o();I.channelCount=D,A.channelCount=D},get channelCountMode(){return A.channelCountMode},set channelCountMode(D){if(D==="max")throw o();I.channelCountMode=D,A.channelCountMode=D},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(D){I.channelInterpretation=D,A.channelInterpretation=D},get coneInnerAngle(){return A.coneInnerAngle},set coneInnerAngle(D){A.coneInnerAngle=D},get coneOuterAngle(){return A.coneOuterAngle},set coneOuterAngle(D){A.coneOuterAngle=D},get coneOuterGain(){return A.coneOuterGain},set coneOuterGain(D){if(D<0||D>1)throw e();A.coneOuterGain=D},get context(){return A.context},get distanceModel(){return A.distanceModel},set distanceModel(D){A.distanceModel=D},get inputs(){return[I]},get maxDistance(){return A.maxDistance},set maxDistance(D){if(D<0)throw new RangeError;A.maxDistance=D},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get orientationX(){return O.gain},get orientationY(){return F.gain},get orientationZ(){return P.gain},get panningModel(){return A.panningModel},set panningModel(D){A.panningModel=D},get positionX(){return N.gain},get positionY(){return $.gain},get positionZ(){return V.gain},get refDistance(){return A.refDistance},set refDistance(D){if(D<0)throw new RangeError;A.refDistance=D},get rolloffFactor(){return A.rolloffFactor},set rolloffFactor(D){if(D<0)throw new RangeError;A.rolloffFactor=D},addEventListener(...D){return I.addEventListener(D[0],D[1],D[2])},dispatchEvent(...D){return I.dispatchEvent(D[0])},removeEventListener(...D){return I.removeEventListener(D[0],D[1],D[2])}};h!==z.coneInnerAngle&&(z.coneInnerAngle=h),d!==z.coneOuterAngle&&(z.coneOuterAngle=d),p!==z.coneOuterGain&&(z.coneOuterGain=p),f!==z.distanceModel&&(z.distanceModel=f),m!==z.maxDistance&&(z.maxDistance=m),g!==z.orientationX.value&&(z.orientationX.value=g),y!==z.orientationY.value&&(z.orientationY.value=y),b!==z.orientationZ.value&&(z.orientationZ.value=b),S!==z.panningModel&&(z.panningModel=S),x!==z.positionX.value&&(z.positionX.value=x),_!==z.positionY.value&&(z.positionY.value=_),C!==z.positionZ.value&&(z.positionZ.value=C),T!==z.refDistance&&(z.refDistance=T),v!==z.rolloffFactor&&(z.rolloffFactor=v),(Z[0]!==1||Z[1]!==0||Z[2]!==0)&&A.setOrientation(...Z),(Ee[0]!==0||Ee[1]!==0||Ee[2]!==0)&&A.setPosition(...Ee);const ee=()=>{I.connect(A),s(I,j,0,0),j.connect(O).connect(k,0,0),j.connect(F).connect(k,0,1),j.connect(P).connect(k,0,2),j.connect(N).connect(k,0,3),j.connect($).connect(k,0,4),j.connect(V).connect(k,0,5),k.connect(B).connect(u.destination)},Te=()=>{I.disconnect(A),a(I,j,0,0),j.disconnect(O),O.disconnect(k),j.disconnect(F),F.disconnect(k),j.disconnect(P),P.disconnect(k),j.disconnect(N),N.disconnect(k),j.disconnect($),$.disconnect(k),j.disconnect(V),V.disconnect(k),k.disconnect(B),B.disconnect(u.destination)};return l(Xt(z,A),ee,Te)},ku=s=>(e,{disableNormalization:t,imag:n,real:r})=>{const i=n instanceof Float32Array?n:new Float32Array(n),o=r instanceof Float32Array?r:new Float32Array(r),a=e.createPeriodicWave(o,i,{disableNormalization:t});if(Array.from(n).length<2)throw s();return a},vn=(s,e,t,n)=>s.createScriptProcessor(e,t,n),xu=(s,e)=>(t,n)=>{const r=n.channelCountMode;if(r==="clamped-max")throw e();if(t.createStereoPanner===void 0)return s(t,n);const i=t.createStereoPanner();return pe(i,n),oe(i,n,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>r,set:o=>{if(o!==r)throw e()}}),i},wu=(s,e,t,n,r,i)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(f,m,g,y)=>{const b=new Float32Array(16385),S=new Float32Array(16385);for(let R=0;R<16385;R+=1){const A=R/16384*c;b[R]=Math.cos(A),S[R]=Math.sin(A)}const x=t(f,{...l,gain:0}),_=n(f,{...u,curve:b}),C=n(f,{...u,curve:a}),T=t(f,{...l,gain:0}),v=n(f,{...u,curve:S});return{connectGraph(){m.connect(x),m.connect(C.inputs===void 0?C:C.inputs[0]),m.connect(T),C.connect(g),g.connect(_.inputs===void 0?_:_.inputs[0]),g.connect(v.inputs===void 0?v:v.inputs[0]),_.connect(x.gain),v.connect(T.gain),x.connect(y,0,0),T.connect(y,0,1)},disconnectGraph(){m.disconnect(x),m.disconnect(C.inputs===void 0?C:C.inputs[0]),m.disconnect(T),C.disconnect(g),g.disconnect(_.inputs===void 0?_:_.inputs[0]),g.disconnect(v.inputs===void 0?v:v.inputs[0]),_.disconnect(x.gain),v.disconnect(T.gain),x.disconnect(y,0,0),T.disconnect(y,0,1)}}},d=(f,m,g,y)=>{const b=new Float32Array(16385),S=new Float32Array(16385),x=new Float32Array(16385),_=new Float32Array(16385),C=Math.floor(16385/2);for(let N=0;N<16385;N+=1)if(N>C){const $=(N-C)/(16384-C)*c;b[N]=Math.cos($),S[N]=Math.sin($),x[N]=0,_[N]=1}else{const $=N/(16384-C)*c;b[N]=1,S[N]=0,x[N]=Math.cos($),_[N]=Math.sin($)}const T=e(f,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=t(f,{...l,gain:0}),R=n(f,{...u,curve:b}),A=t(f,{...l,gain:0}),w=n(f,{...u,curve:S}),k=n(f,{...u,curve:a}),I=t(f,{...l,gain:0}),O=n(f,{...u,curve:x}),F=t(f,{...l,gain:0}),P=n(f,{...u,curve:_});return{connectGraph(){m.connect(T),m.connect(k.inputs===void 0?k:k.inputs[0]),T.connect(v,0),T.connect(A,0),T.connect(I,1),T.connect(F,1),k.connect(g),g.connect(R.inputs===void 0?R:R.inputs[0]),g.connect(w.inputs===void 0?w:w.inputs[0]),g.connect(O.inputs===void 0?O:O.inputs[0]),g.connect(P.inputs===void 0?P:P.inputs[0]),R.connect(v.gain),w.connect(A.gain),O.connect(I.gain),P.connect(F.gain),v.connect(y,0,0),I.connect(y,0,0),A.connect(y,0,1),F.connect(y,0,1)},disconnectGraph(){m.disconnect(T),m.disconnect(k.inputs===void 0?k:k.inputs[0]),T.disconnect(v,0),T.disconnect(A,0),T.disconnect(I,1),T.disconnect(F,1),k.disconnect(g),g.disconnect(R.inputs===void 0?R:R.inputs[0]),g.disconnect(w.inputs===void 0?w:w.inputs[0]),g.disconnect(O.inputs===void 0?O:O.inputs[0]),g.disconnect(P.inputs===void 0?P:P.inputs[0]),R.disconnect(v.gain),w.disconnect(A.gain),O.disconnect(I.gain),P.disconnect(F.gain),v.disconnect(y,0,0),I.disconnect(y,0,0),A.disconnect(y,0,1),F.disconnect(y,0,1)}}},p=(f,m,g,y,b)=>{if(m===1)return h(f,g,y,b);if(m===2)return d(f,g,y,b);throw r()};return(f,{channelCount:m,channelCountMode:g,pan:y,...b})=>{if(g==="max")throw r();const S=s(f,{...b,channelCount:1,channelCountMode:g,numberOfInputs:2}),x=t(f,{...b,channelCount:m,channelCountMode:g,gain:1}),_=t(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:C,disconnectGraph:T}=p(f,m,x,_,S);Object.defineProperty(_.gain,"defaultValue",{get:()=>0}),Object.defineProperty(_.gain,"maxValue",{get:()=>1}),Object.defineProperty(_.gain,"minValue",{get:()=>-1});const v={get bufferSize(){},get channelCount(){return x.channelCount},set channelCount(k){x.channelCount!==k&&(R&&T(),{connectGraph:C,disconnectGraph:T}=p(f,k,x,_,S),R&&C()),x.channelCount=k},get channelCountMode(){return x.channelCountMode},set channelCountMode(k){if(k==="clamped-max"||k==="max")throw r();x.channelCountMode=k},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(k){x.channelInterpretation=k},get context(){return x.context},get inputs(){return[x]},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},get pan(){return _.gain},addEventListener(...k){return x.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return x.dispatchEvent(k[0])},removeEventListener(...k){return x.removeEventListener(k[0],k[1],k[2])}};let R=!1;const A=()=>{C(),R=!0},w=()=>{T(),R=!1};return i(Xt(v,S),A,w)}},Au=(s,e,t,n,r,i,o)=>(a,c)=>{const l=a.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);pe(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();te(l,{curve:u},"curve"),te(l,c,"oversample");let h=null,d=!1;return o(l,"curve",m=>()=>m.call(l),m=>g=>(m.call(l,g),d&&(n(g)&&h===null?h=s(a,l):!n(g)&&h!==null&&(h(),h=null)),g)),r(l,()=>{d=!0,n(l.curve)&&(h=s(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},Ru=(s,e,t,n,r)=>(i,{curve:o,oversample:a,...c})=>{const l=i.createWaveShaper(),u=i.createWaveShaper();pe(l,c),pe(u,c);const h=t(i,{...c,gain:1}),d=t(i,{...c,gain:-1}),p=t(i,{...c,gain:1}),f=t(i,{...c,gain:-1});let m=null,g=!1,y=null;const b={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(_){h.channelCount=_,d.channelCount=_,l.channelCount=_,p.channelCount=_,u.channelCount=_,f.channelCount=_},get channelCountMode(){return l.channelCountMode},set channelCountMode(_){h.channelCountMode=_,d.channelCountMode=_,l.channelCountMode=_,p.channelCountMode=_,u.channelCountMode=_,f.channelCountMode=_},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(_){h.channelInterpretation=_,d.channelInterpretation=_,l.channelInterpretation=_,p.channelInterpretation=_,u.channelInterpretation=_,f.channelInterpretation=_},get context(){return l.context},get curve(){return y},set curve(_){if(_!==null&&_.length<2)throw e();if(_===null)l.curve=_,u.curve=_;else{const C=_.length,T=new Float32Array(C+2-C%2),v=new Float32Array(C+2-C%2);T[0]=_[0],v[0]=-_[C-1];const R=Math.ceil((C+1)/2),A=(C+1)/2-1;for(let w=1;w<R;w+=1){const k=w/R*A,I=Math.floor(k),O=Math.ceil(k);T[w]=I===O?_[I]:(1-(k-I))*_[I]+(1-(O-k))*_[O],v[w]=I===O?-_[C-1-I]:-((1-(k-I))*_[C-1-I])-(1-(O-k))*_[C-1-O]}T[R]=C%2===1?_[R-1]:(_[R-2]+_[R-1])/2,l.curve=T,u.curve=v}y=_,g&&(n(y)&&m===null?m=s(i,h):m!==null&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(_){l.oversample=_,u.oversample=_},addEventListener(..._){return h.addEventListener(_[0],_[1],_[2])},dispatchEvent(..._){return h.dispatchEvent(_[0])},removeEventListener(..._){return h.removeEventListener(_[0],_[1],_[2])}};o!==null&&(b.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==b.oversample&&(b.oversample=a);const S=()=>{h.connect(l).connect(p),h.connect(d).connect(u).connect(f).connect(p),g=!0,n(y)&&(m=s(i,h))},x=()=>{h.disconnect(l),l.disconnect(p),h.disconnect(d),d.disconnect(u),u.disconnect(f),f.disconnect(p),g=!1,m!==null&&(m(),m=null)};return r(Xt(b,p),S,x)},xe=()=>new DOMException("","NotSupportedError"),Eu={numberOfChannels:1},Ou=(s,e,t,n,r)=>class extends s{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...Eu,...l},p=n(h,u,d);e(ln,()=>ln(p))||p.addEventListener("statechange",(()=>{let f=0;const m=g=>{this._state==="running"&&(f>0?(p.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):f+=1)};return m})()),super(p,h),this._length=u,this._nativeOfflineAudioContext=p,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Ii(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},Iu={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Mu=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),h={...Iu,...l},d=t(u,h),p=i(u),f=p?n():null,m=c.sampleRate/2;super(c,!1,d,f),this._detune=e(this,p,d.detune,153600,-153600),this._frequency=e(this,p,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=f,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){Bt(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),tt(this)&&mn(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},Pu=(s,e,t,n,r)=>()=>{const i=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=t(u);const p=Ce(d,h);if(!p){const f={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,f),a!==null&&d.start(a),c!==null&&d.stop(c)}return i.set(h,d),p?(await s(h,u.detune,d.detune),await s(h,u.frequency,d.frequency)):(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)),await r(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=i.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Nu={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Du=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),h={...Nu,...l},d=t(u,h),p=i(u),f=p?n():null;super(c,!1,d,f),this._nativePannerNode=d,this._orientationX=e(this,p,d.orientationX,be,Ie),this._orientationY=e(this,p,d.orientationY,be,Ie),this._orientationZ=e(this,p,d.orientationZ,be,Ie),this._positionX=e(this,p,d.positionX,be,Ie),this._positionY=e(this,p,d.positionY,be,Ie),this._positionZ=e(this,p,d.positionZ,be,Ie),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Fu=(s,e,t,n,r,i,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(p,f)=>{let m=null,g=i(p);const y={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},b={...y,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},S=Ce(g,f);if("bufferSize"in g)m=n(f,{...y,gain:1});else if(!S){const x={...b,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=r(f,x)}if(u.set(f,m===null?g:m),m!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const w=new o(6,p.context.length,f.sampleRate),k=e(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});k.connect(w.destination),h=(async()=>{const I=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map(async(O,F)=>{const P=t(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:F===0?1:0});return await a(w,O,P.offset),P}));for(let O=0;O<6;O+=1)I[O].connect(k,0,O),I[O].start(0);return l(w)})()}const x=await h,_=n(f,{...y,gain:1});await c(p,f,_);const C=[];for(let w=0;w<x.numberOfChannels;w+=1)C.push(x.getChannelData(w));let T=[C[0][0],C[1][0],C[2][0]],v=[C[3][0],C[4][0],C[5][0]],R=n(f,{...y,gain:1}),A=r(f,{...b,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:v[0],positionY:v[1],positionZ:v[2]});_.connect(R).connect(A.inputs[0]),A.connect(m);for(let w=128;w<x.length;w+=128){const k=[C[0][w],C[1][w],C[2][w]],I=[C[3][w],C[4][w],C[5][w]];if(k.some((O,F)=>O!==T[F])||I.some((O,F)=>O!==v[F])){T=k,v=I;const O=w/f.sampleRate;R.gain.setValueAtTime(0,O),R=n(f,{...y,gain:0}),A=r(f,{...b,orientationX:T[0],orientationY:T[1],orientationZ:T[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),R.gain.setValueAtTime(1,O),_.connect(R).connect(A.inputs[0]),A.connect(m)}}return m}return S?(await s(f,p.orientationX,g.orientationX),await s(f,p.orientationY,g.orientationY),await s(f,p.orientationZ,g.orientationZ),await s(f,p.positionX,g.positionX),await s(f,p.positionY,g.positionY),await s(f,p.positionZ,g.positionZ)):(await a(f,p.orientationX,g.orientationX),await a(f,p.orientationY,g.orientationY),await a(f,p.orientationZ,g.orientationZ),await a(f,p.positionX,g.positionX),await a(f,p.positionY,g.positionY),await a(f,p.positionZ,g.positionZ)),Zt(g)?await c(p,f,g.inputs[0]):await c(p,f,g),g};return{render(p,f){const m=u.get(f);return m!==void 0?Promise.resolve(m):d(p,f)}}},Vu={disableNormalization:!1},Lu=(s,e,t,n)=>class Wi{constructor(i,o){const a=e(i),c=n({...Vu,...o}),l=s(a,c);return t.add(l),l}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===Wi.prototype||t.has(i)}},ju=(s,e)=>(t,n,r)=>(s(n).replay(r),e(n,t,r)),Bu=(s,e,t)=>async(n,r,i)=>{const o=s(n);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,r),p=n.context.destination;!t(l)&&(n!==p||!t(n))&&d.connect(i,u,c)})).reduce((a,c)=>[...a,...c],[]))},Wu=(s,e,t)=>async(n,r,i)=>{const o=e(n);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await s(a).render(a,r);t(a)||u.connect(i,c)}))},qu=(s,e,t,n)=>r=>s(ln,()=>ln(r))?Promise.resolve(s(n,n)).then(i=>{if(!i){const o=t(r,512,0,1);r.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>r.currentTime,o.connect(r.destination)}return r.startRendering()}):new Promise(i=>{const o=e(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.oncomplete=a=>{o.disconnect(),i(a.renderedBuffer)},o.connect(r.destination),r.startRendering()}),$u=s=>(e,t)=>{s.set(e,t)},Uu=s=>(e,t)=>s.set(e,t),zu=(s,e,t,n,r,i,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(n(l)).map(u=>t(u).render(u,l)))).then(()=>r(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),Js(u)):e(i,()=>i(u))||a(u),s.add(u),u)),Gu={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Yu=(s,e,t,n,r,i)=>class extends s{constructor(a,c){const l=r(a),u={...Gu,...c},h=t(l,u),d=i(l),p=d?n():null;super(a,!1,h,p),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},Zu=(s,e,t,n,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let l=t(a);const u=Ce(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return i.set(c,l),u?await s(c,a.pan,l.pan):await n(c,a.pan,l.pan),Zt(l)?await r(a,c,l.inputs[0]):await r(a,c,l),l};return{render(a,c){const l=i.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Xu=s=>()=>{if(s===null)return!1;try{new s({length:1,sampleRate:44100})}catch{return!1}return!0},Hu=(s,e)=>async()=>{if(s===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),r=URL.createObjectURL(t);let i=!1,o=!1;try{await n.audioWorklet.addModule(r);const a=new s(n,"a",{numberOfOutputs:0}),c=n.createOscillator();a.port.onmessage=()=>i=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await n.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(r)}return i&&!o},Ju=(s,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),n=s(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(r=>{t.oncomplete=()=>{n.disconnect(),r(t.currentTime!==0)},t.startRendering()})},Qu=()=>new DOMException("","UnknownError"),Ku={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},eh=(s,e,t,n,r,i,o)=>class extends s{constructor(c,l){const u=r(c),h={...Ku,...l},d=t(u,h),f=i(u)?n():null;super(c,!0,d,f),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},th=(s,e,t)=>()=>{const n=new WeakMap,r=async(i,o)=>{let a=e(i);if(!Ce(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=s(o,l)}return n.set(o,a),Zt(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},nh=()=>typeof window>"u"?null:window,sh=(s,e)=>t=>{t.copyFromChannel=(n,r,i=0)=>{const o=s(i),a=s(r);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=n.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)n[h]=l[h+o]},t.copyToChannel=(n,r,i=0)=>{const o=s(i),a=s(r);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=n.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=n[h]}},rh=s=>e=>{e.copyFromChannel=(t=>(n,r,i=0)=>{const o=s(i),a=s(r);if(o<e.length)return t.call(e,n,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(n,r,i=0)=>{const o=s(i),a=s(r);if(o<e.length)return t.call(e,n,a,o)})(e.copyToChannel)},ih=s=>(e,t)=>{const n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),s(e,"buffer",r=>()=>{const i=r.call(e);return i===n?null:i},r=>i=>r.call(e,i===null?n:i))},oh=(s,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw s()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw s()}});const r=t.createBufferSource();e(n,()=>{const a=n.numberOfInputs;for(let c=0;c<a;c+=1)r.connect(n,0,c)},()=>r.disconnect(n))},qi=(s,e,t)=>s.copyFromChannel===void 0?s.getChannelData(t)[0]:(s.copyFromChannel(e,t),e[0]),$i=s=>{if(s===null)return!1;const e=s.length;return e%2!==0?s[Math.floor(e/2)]!==0:s[e/2-1]+s[e/2]!==0},Cn=(s,e,t,n)=>{let r=s;for(;!r.hasOwnProperty(e);)r=Object.getPrototypeOf(r);const{get:i,set:o}=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(s,e,{get:t(i),set:n(o)})},ah=s=>({...s,outputChannelCount:s.outputChannelCount!==void 0?s.outputChannelCount:s.numberOfInputs===1&&s.numberOfOutputs===1?[s.channelCount]:Array.from({length:s.numberOfOutputs},()=>1)}),ch=s=>({...s,channelCount:s.numberOfOutputs}),lh=s=>{const{imag:e,real:t}=s;return e===void 0?t===void 0?{...s,imag:[0,0],real:[0,0]}:{...s,imag:Array.from(t,()=>0),real:t}:t===void 0?{...s,imag:e,real:Array.from(e,()=>0)}:{...s,imag:e,real:t}},Ui=(s,e,t)=>{try{s.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;Ui(s,e,t+1e-7)}},uh=s=>{const e=s.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},hh=s=>{const e=s.createBufferSource(),t=s.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},dh=s=>{const e=s.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},nr=s=>{const e=s.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},zi=s=>{const e=s.createBuffer(1,1,44100),t=s.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},sr=s=>{const e=s.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},ph=s=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(s)}finally{e.close(),t.close()}},fh=s=>{s.start=(e=>(t=0,n=0,r)=>{const i=s.buffer,o=i===null?n:Math.min(i.duration,n);i!==null&&o>i.duration-.5/s.context.sampleRate?e.call(s,t,0,0):e.call(s,t,o,r)})(s.start)},Gi=(s,e)=>{const t=e.createGain();s.connect(t);const n=(r=>()=>{r.call(s,t),s.removeEventListener("ended",n)})(s.disconnect);s.addEventListener("ended",n),Xt(s,t),s.stop=(r=>{let i=!1;return(o=0)=>{if(i)try{r.call(s,o)}catch{t.gain.setValueAtTime(0,o)}else r.call(s,o),i=!0}})(s.stop)},Ht=(s,e)=>t=>{const n={value:s};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(s,t):e.handleEvent.call(s,t)},mh=Da(St),gh=Wa(St),_h=Kc(es),Yi=new WeakMap,yh=_l(Yi),ze=Ec(new Map,new WeakMap),He=nh(),Zi=Yl(ze,Je),rr=gl(Se),_e=Bu(Se,rr,Ct),vh=Ga(Zi,K,_e),J=Cl(Kn),st=Cu(He),H=Vl(st),Xi=new WeakMap,Hi=ll(Ht),Tn=Jl(He),ir=Pl(Tn),or=Nl(He),Ji=Dl(He),un=Kl(He),le=_c(Fa(ki),Ba(mh,gh,$n,_h,Un,Se,yh,fn,K,St,tt,Ct,On),ze,Rl(Es,Un,Se,K,cn,tt),Je,ts,xe,Xc($n,Es,Se,K,cn,J,tt,H),nl(Xi,Se,Ue),Hi,J,ir,or,Ji,H,un),Ch=za(le,vh,Je,Zi,J,H),ar=new WeakSet,ni=Zl(He),Qi=qc(new Uint32Array(1)),cr=sh(Qi,Je),lr=rh(Qi),Ki=Za(ar,ze,xe,ni,st,Xu(ni),cr,lr),ns=qa(Re),eo=Wu(rr,gn,Ct),Qe=Fc(eo),Jt=Hl(ns,ze,uh,hh,dh,nr,zi,sr,fh,ih(Cn),Gi),Ke=ju(yl(gn),eo),Th=Ja(Qe,Jt,K,Ke,_e),Ge=yc(Va(xi),Xi,Hs,vc,Ea,Oa,Ia,Ma,Pa,ws,bi,Tn,Ui),bh=Ha(le,Th,Ge,me,Jt,J,H,Ht),Sh=oc(le,ac,Je,me,Ql(Re,Cn),J,H,_e),kh=Rc(Qe,ji,K,Ke,_e),kt=Uu(Yi),xh=Ac(le,Ge,kh,ts,ji,J,H,kt),pt=zl(St,or),wh=oh(me,pt),ft=ou(Tn,wh),Ah=Mc(ft,K,_e),Rh=Ic(le,Ah,ft,J,H),Eh=Dc(yn,K,_e),Oh=Nc(le,Eh,yn,J,H,ch),Ih=lu(ns,Jt,Re,pt),Qt=cu(ns,ze,Ih,nr,sr),Mh=Wc(Qe,Qt,K,Ke,_e),Ph=Bc(le,Ge,Mh,Qt,J,H,Ht),to=uu(xe,Cn),Nh=zc(to,K,_e),Dh=Uc(le,Nh,to,J,H,kt),Fh=Qc(Qe,Bi,K,Ke,_e),Vh=Jc(le,Ge,Fh,Bi,J,H,kt),no=hu(xe),Lh=ol(Qe,no,K,Ke,_e),jh=il(le,Ge,Lh,no,xe,J,H,kt),Bh=fl(Qe,Re,K,Ke,_e),Wh=pl(le,Ge,Bh,Re,J,H),qh=mu(ts,me,vn,xe),ss=qu(ze,Re,vn,Ju(Re,st)),$h=Al(Jt,K,st,_e,ss),Uh=du(qh),zh=xl(le,Uh,$h,J,H,kt),Gh=cc(Ge,ft,Qt,vn,xe,qi,H,Cn),so=new WeakMap,Yh=Ul(Sh,Gh,Hi,H,so,Ht),ro=Tu(ns,ze,nr,zi,sr,Gi),Zh=Pu(Qe,ro,K,Ke,_e),Xh=Mu(le,Ge,ro,Zh,J,H,Ht),io=Lc(Jt),Hh=Ru(io,me,Re,$i,pt),rs=Au(io,me,Hh,$i,pt,Tn,Cn),Jh=Su($n,me,ft,Re,vn,rs,xe,Un,qi,pt),oo=bu(Jh),Qh=Fu(Qe,ft,Qt,Re,oo,K,st,Ke,_e,ss),Kh=Du(le,Ge,oo,Qh,J,H,kt),ed=ku(Je),td=Lu(ed,J,new WeakSet,lh),nd=wu(ft,yn,Re,rs,xe,pt),ao=xu(nd,xe),sd=Zu(Qe,ao,K,Ke,_e),rd=Yu(le,Ge,ao,sd,J,H),id=th(rs,K,_e),od=eh(le,me,rs,id,J,H,kt),co=Ll(He),ur=ul(He),lo=new WeakMap,ad=Tl(lo,st),cd=co?ja(ze,xe,cl(He),ur,hl(Na),J,ad,H,un,new WeakMap,new WeakMap,Hu(un,st),He):void 0,ld=Fl(ir,H),ud=Zc(ar,ze,Yc,al,new WeakSet,J,ld,Wn,ln,cr,lr),uo=xc(cd,Ch,Ki,bh,xh,Rh,Oh,Ph,Dh,ud,Vh,jh,Wh,zh,Yh,Xh,Kh,td,rd,od),hd=jl(le,gu,J,H),dd=Wl(le,_u,J,H),pd=ql(le,yu,J,H),fd=vu(me,H),md=$l(le,fd,J),gd=ic(uo,me,xe,Qu,hd,dd,pd,md,Tn),hr=bl(so),_d=$a(hr),ho=Vc(Je),yd=el(hr),po=sl(Je),fo=new WeakMap,vd=ml(fo,Ue),Cd=iu(ho,Je,me,ft,yn,Qt,Re,vn,xe,po,ur,vd,pt),Td=tu(me,Cd,Re,xe,pt),bd=kc(Qe,ho,Jt,ft,yn,Qt,Re,yd,po,ur,K,un,st,Ke,_e,ss),Sd=vl(lo),kd=$u(fo),si=co?Tc(_d,le,Ge,bd,Td,Se,Sd,J,H,un,ah,kd,ph,Ht):void 0,xd=Gc(xe,st),wd=zu(ar,ze,rr,hr,ss,Wn,cr,lr),Ad=Ou(uo,ze,me,xd,wd),Rd=El(Kn,ir),Ed=Ol(Xs,or),Od=Il(Hs,Ji),Id=Ml(Kn,H);function Ve(s){return s===void 0}function G(s){return s!==void 0}function Md(s){return typeof s=="function"}function Tt(s){return typeof s=="number"}function vt(s){return Object.prototype.toString.call(s)==="[object Object]"&&s.constructor===Object}function Pd(s){return typeof s=="boolean"}function $e(s){return Array.isArray(s)}function nt(s){return typeof s=="string"}function Rn(s){return nt(s)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(s)}function q(s,e){if(!s)throw new Error(e)}function ht(s,e,t=1/0){if(!(e<=s&&s<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${s}`)}function mo(s){!s.isOffline&&s.state!=="running"&&dr('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let go=!1,ri=!1;function ii(s){go=s}function Nd(s){Ve(s)&&go&&!ri&&(ri=!0,dr("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let _o=console;function Dd(...s){_o.log(...s)}function dr(...s){_o.warn(...s)}function Fd(s){return new gd(s)}function Vd(s,e,t){return new Ad(s,e,t)}const Me=typeof self=="object"?self:null,Ld=Me&&(Me.hasOwnProperty("AudioContext")||Me.hasOwnProperty("webkitAudioContext"));function jd(s,e,t){return q(G(si),"AudioWorkletNode only works in a secure context (https or localhost)"),new(s instanceof(Me==null?void 0:Me.BaseAudioContext)?Me==null?void 0:Me.AudioWorkletNode:si)(s,e,t)}function Ye(s,e,t,n){var r=arguments.length,i=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(i=(r<3?o(i):r>3?o(e,t,i):o(e,t))||i);return r>3&&i&&Object.defineProperty(e,t,i),i}function he(s,e,t,n){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):r(u.value).then(a,c)}l((n=n.apply(s,e||[])).next())})}class Bd{constructor(e,t,n,r){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(r||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function bt(s){return Od(s)}function lt(s){return Ed(s)}function In(s){return Id(s)}function It(s){return Rd(s)}function Wd(s){return s instanceof Ki}function qd(s,e){return s==="value"||bt(e)||lt(e)||Wd(e)}function Ft(s,...e){if(!e.length)return s;const t=e.shift();if(vt(s)&&vt(t))for(const n in t)qd(n,t[n])?s[n]=t[n]:vt(t[n])?(s[n]||Object.assign(s,{[n]:{}}),Ft(s[n],t[n])):Object.assign(s,{[n]:t[n]});return Ft(s,...e)}function $d(s,e){return s.length===e.length&&s.every((t,n)=>e[n]===t)}function W(s,e,t=[],n){const r={},i=Array.from(e);if(vt(i[0])&&n&&!Reflect.has(i[0],n)&&(Object.keys(i[0]).some(a=>Reflect.has(s,a))||(Ft(r,{[n]:i[0]}),t.splice(t.indexOf(n),1),i.shift())),i.length===1&&vt(i[0]))Ft(r,i[0]);else for(let o=0;o<t.length;o++)G(i[o])&&(r[t[o]]=i[o]);return Ft(s,r)}function Ud(s){return s.constructor.getDefaults()}function Vt(s,e){return Ve(s)?e:s}function oi(s,e){return e.forEach(t=>{Reflect.has(s,t)&&delete s[t]}),s}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class rt{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Me&&this.toString()===Me.TONE_DEBUG_CLASS)&&Dd(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}rt.version=Ti;const pr=1e-6;function Wt(s,e){return s>e+pr}function Ns(s,e){return Wt(s,e)||je(s,e)}function Zn(s,e){return s+pr<e}function je(s,e){return Math.abs(s-e)<pr}function zd(s,e,t){return Math.max(Math.min(s,t),e)}class Le extends rt{constructor(){super(),this.name="Timeline",this._timeline=[];const e=W(Le.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(q(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];q(Ns(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(je(this._timeline[t].time,e)){for(let n=t;n>=0&&je(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&Ns(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0;const r=this._timeline.length;let i=r;if(r>0&&this._timeline[r-1][t]<=e)return r-1;for(;n<i;){let o=Math.floor(n+(i-n)/2);const a=this._timeline[o],c=this._timeline[o+1];if(je(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(je(u[t],e))o=l;else break}return o}else{if(Zn(a[t],e)&&Wt(c[t],e))return o;Wt(a[t],e)?i=o:n=o+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let r=this._search(e),i=this._search(t);return r!==-1&&i!==-1?(this._timeline[r].time!==e&&(r+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,r,i)):r===-1&&this._iterate(n,0,i),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(n!==-1&&je(this._timeline[n].time,e)){let r=n;for(let i=n;i>=0&&je(this._timeline[i].time,e);i--)r=i;this._iterate(i=>{t(i)},r,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const yo=[];function is(s){yo.push(s)}function Gd(s){yo.forEach(e=>e(s))}const vo=[];function os(s){vo.push(s)}function Yd(s){vo.forEach(e=>e(s))}class bn extends rt{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(r=>{Ve(this._events)&&(this._events={}),this._events.hasOwnProperty(r)||(this._events[r]=[]),this._events[r].push(t)}),this}once(e,t){const n=(...r)=>{t(...r),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(r=>{if(Ve(this._events)&&(this._events={}),this._events.hasOwnProperty(r))if(Ve(t))this._events[r]=[];else{const i=this._events[r];for(let o=i.length-1;o>=0;o--)i[o]===t&&i.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let r=0,i=n.length;r<i;r++)n[r].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(bn.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class Co extends bn{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Sn extends Co{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Le,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const n=W(Sn.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=Fd({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new Bd(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Gd(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return q(It(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return q(It(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return q(It(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){q(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){q(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){q(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){q(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return jd(this.rawContext,e,t)}addAudioWorkletModule(e){return he(this,void 0,void 0,function*(){q(G(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return he(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return It(this._context)?this._context.resume():Promise.resolve()}close(){return he(this,void 0,void 0,function*(){It(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&Yd(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=e;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=t,r.loop=!0,r.start(0),this._constants.set(e,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,r=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),r()},id:n,time:i+t})};return r(),n}}class Zd extends Co{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return he(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function ae(s,e){$e(e)?e.forEach(t=>ae(s,t)):Object.defineProperty(s,e,{enumerable:!0,writable:!1})}function To(s,e){$e(e)?e.forEach(t=>To(s,t)):Object.defineProperty(s,e,{writable:!0})}const X=()=>{};class Q extends rt{constructor(){super(),this.name="ToneAudioBuffer",this.onload=X;const e=W(Q.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,nt(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:X,onload:X,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:De().sampleRate}set(e){return e instanceof Q?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return he(this,void 0,void 0,function*(){const t=Q.load(e).then(n=>{this.set(n),this.onload(this)});Q.downloads.push(t);try{yield t}finally{const n=Q.downloads.indexOf(t);Q.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=$e(e)&&e[0].length>0,n=t?e.length:1,r=t?e[0].length:e.length,i=De(),o=i.createBuffer(n,r,i.sampleRate),a=!t&&n===1?[e]:e;for(let c=0;c<n;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(Tt(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const n=this.numberOfChannels;for(let r=0;r<n;r++){const i=this.toArray(r);for(let o=0;o<i.length;o++)t[o]+=i[o]}t=t.map(r=>r/n),this.fromArray(t)}return this}toArray(e){if(Tt(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){q(this.loaded,"Buffer is not loaded");const n=Math.floor(e*this.sampleRate),r=Math.floor(t*this.sampleRate);q(n<r,"The start time must be less than the end time");const i=r-n,o=De().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(n,r),a);return new Q(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Q().fromArray(e)}static fromUrl(e){return he(this,void 0,void 0,function*(){return yield new Q().load(e)})}static load(e){return he(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let l=c[0];for(const u of c)if(Q.supportsType(u)){l=u;break}e=e.replace(t[0],l)}const n=Q.baseUrl===""||Q.baseUrl.endsWith("/")?Q.baseUrl:Q.baseUrl+"/",r=document.createElement("a");r.href=n+e,r.pathname=(r.pathname+r.hash).split("/").map(encodeURIComponent).join("/");const i=yield fetch(r.href);if(!i.ok)throw new Error(`could not load url: ${e}`);const o=yield i.arrayBuffer();return yield De().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),n=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return he(this,void 0,void 0,function*(){for(yield Promise.resolve();Q.downloads.length;)yield Q.downloads[0]})}}Q.baseUrl="";Q.downloads=[];class fr extends Sn{constructor(){super({clockSource:"offline",context:In(arguments[0])?arguments[0]:Vd(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:In(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=In(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return he(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(r=>setTimeout(r,1)))}})}render(){return he(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Q(t)})}close(){return Promise.resolve()}}const bo=new Zd;let Pt=bo;function De(){return Pt===bo&&Ld&&Xd(new Sn),Pt}function Xd(s,e=!1){e&&Pt.dispose(),It(s)?Pt=new Sn(s):In(s)?Pt=new fr(s):Pt=s}if(Me&&!Me.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Ti} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function Hd(s){return Math.pow(10,s/20)}function Jd(s){return 20*(Math.log(s)/Math.LN10)}function So(s){return Math.pow(2,s/12)}let as=440;function Qd(){return as}function Kd(s){as=s}function Ds(s){return Math.round(ko(s))}function ko(s){return 69+12*Math.log2(s/as)}function ep(s){return as*Math.pow(2,(s-69)/12)}class mr extends rt{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),r=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/n)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let r=0;return e&&e!=="0"&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(r+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(r+=this._beatsToUnits(parseFloat(n)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof mr&&this.fromType(this._val),Ve(this._val))return this._noArg();if(nt(this._val)&&Ve(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(vt(this._val)){let e=0;for(const t in this._val)if(G(this._val[t])){const n=this._val[t],r=new this.constructor(this.context,t).valueOf()*n;e+=r}return e}if(G(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return nt(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class qe extends mr{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new qe(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),r=this.valueOf(),a=Math.round(r/n)*n-r;return r+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let n=t[0],r=new qe(this.context,t[0]).toSeconds();return t.forEach(i=>{const o=new qe(this.context,i).toSeconds();Math.abs(o-e)<Math.abs(r-e)&&(n=i,r=o)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let r=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=r.toString();return i.length>3&&(r=parseFloat(parseFloat(i).toFixed(3))),[n,t,r].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Ds(this.toFrequency())}_now(){return this.context.now()}}class Fe extends qe{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Qd()}static set A4(e){Kd(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Fe.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const r=tp[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?r:Fe.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let r=1;return e&&e!=="0"&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(r*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}})}transpose(e){return new Fe(this.context,this.valueOf()*So(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return Ds(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Fe.A4);let n=Math.round(12*t)+57;const r=Math.floor(n/12);return r<0&&(n+=-12*r),np[n%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return ep(e)}static ftom(e){return Ds(e)}}const tp={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},np=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class rn extends qe{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ae extends rt{constructor(){super();const e=W(Ae.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:De()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return Nd(e),new qe(this.context,e).toSeconds()}toFrequency(e){return new Fe(this.context,e).toFrequency()}toTicks(e){return new rn(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{Ve(e[n])&&delete t[n]}),t}get(){const e=Ud(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];G(n)&&G(n.value)&&G(n.setValueAtTime)?e[t]=n.value:n instanceof Ae?e[t]=n._getPartialProperties(e[t]):$e(n)||Tt(n)||nt(n)||Pd(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&G(this[t])&&(this[t]&&G(this[t].value)&&G(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Ae?this[t].set(e[t]):this[t]=e[t])}),this}}class gr extends Le{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return ht(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){const n=this._search(t);for(let r=n;r>=0;r--){const i=this._timeline[r];if(i.state===e)return i}}getNextState(e,t){const n=this._search(t);if(n!==-1)for(let r=n;r<this._timeline.length;r++){const i=this._timeline[r];if(i.state===e)return i}}}class se extends Ae{constructor(){const e=W(se.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,q(G(e.param)&&(bt(e.param)||e.param instanceof se),"param must be an AudioParam");!bt(e.param);)e.param=e.param._param;this._swappable=G(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Le(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,G(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ae.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return G(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return G(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return G(this.maxValue)&&G(this.minValue)&&ht(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Hd(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Jd(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),r=this._fromType(e);return q(isFinite(r)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(r),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),r=this._events.get(t);let i=this._initialValue;if(r===null)i=this._initialValue;else if(r.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const o=this._events.getBefore(r.time);let a;o===null?a=this._initialValue:a=o.value,r.type==="setTargetAtTime"&&(i=this._exponentialApproach(r.time,a,r.value,r.constant,t))}else if(n===null)i=r.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let o=r.value;if(r.type==="setTargetAtTime"){const a=this._events.getBefore(r.time);a===null?o=this._initialValue:o=a.value}n.type==="linearRampToValueAtTime"?i=this._linearInterpolate(r.time,o,n.time,n.value,t):i=this._exponentialInterpolate(r.time,o,n.time,n.value,t)}else i=r.value;return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),r=this.toSeconds(t);return q(isFinite(n)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:r,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,r),this._param.linearRampToValueAtTime(n,r),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=je(n,0)?this._minOutput:n,this._assertRange(n);const r=this.toSeconds(t);return q(isFinite(n)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,r),this._param.exponentialRampToValueAtTime(n,r),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const r=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,r),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const r=this._fromType(e);q(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(r),q(isFinite(r)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",e,i,n),this._param.setTargetAtTime(r,i,n),this}setValueCurveAtTime(e,t,n,r=1){n=this.toSeconds(n),t=this.toSeconds(t);const i=this._fromType(e[0])*r;this.setValueAtTime(this._toType(i),t);const o=n/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*r;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return q(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));q(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const r=this._events.get(t),i=this._events.getAfter(t);return r&&je(r.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){const r=this._events.getAfter(n.time),i=r?r.time:t+2,o=(i-t)/10;for(let a=t;a<i;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,r=>{r.type==="cancelScheduledValues"?e.cancelScheduledValues(r.time):r.type==="setTargetAtTime"?e.setTargetAtTime(r.value,r.time,r.constant):e[r.type](r.value,r.time)}),this}setParam(e){q(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,r,i){return n+(t-n)*Math.exp(-(i-e)/r)}_linearInterpolate(e,t,n,r,i){return t+(r-t)*((i-e)/(n-e))}_exponentialInterpolate(e,t,n,r,i){return t*Math.pow(r/t,(i-e)/(n-e))}}class U extends Ae{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return G(this.input)?bt(this.input)||this.input instanceof se?1:this.input.numberOfInputs:0}get numberOfOutputs(){return G(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return G(e)&&(e instanceof U||lt(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();q(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return Kt(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return dr("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return sp(this,e,t,n),this}chain(...e){return Fs(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),G(this.input)&&(this.input instanceof U?this.input.dispose():lt(this.input)&&this.input.disconnect()),G(this.output)&&(this.output instanceof U?this.output.dispose():lt(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Fs(...s){const e=s.shift();s.reduce((t,n)=>(t instanceof U?t.connect(n):lt(t)&&Kt(t,n),n),e)}function Kt(s,e,t=0,n=0){for(q(G(s),"Cannot connect from undefined node"),q(G(e),"Cannot connect to undefined node"),(e instanceof U||lt(e))&&q(e.numberOfInputs>0,"Cannot connect to node with no inputs"),q(s.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof U||e instanceof se;)G(e.input)&&(e=e.input);for(;s instanceof U;)G(s.output)&&(s=s.output);bt(e)?s.connect(e,t):s.connect(e,t,n)}function sp(s,e,t=0,n=0){if(G(e))for(;e instanceof U;)e=e.input;for(;!lt(s);)G(s.output)&&(s=s.output);bt(e)?s.disconnect(e,t):lt(e)?s.disconnect(e,t,n):s.disconnect()}class ye extends U{constructor(){const e=W(ye.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new se({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),ae(this,"gain")}static getDefaults(){return Object.assign(U.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class qt extends U{constructor(e){super(e),this.onended=X,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ye({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(U.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:X})}_startGain(e,t=1){q(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){q(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==X&&(this.onended(this),this.onended=X,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),q(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=X,this}}class _r extends qt{constructor(){const e=W(_r.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Kt(this._source,this._gainNode),this.offset=new se({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(qt.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ge extends U{constructor(){const e=W(ge.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new _r({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(U.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return yr(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,r){return this._param.setValueCurveAtTime(e,t,n,r),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function yr(s,e,t,n){(e instanceof se||bt(e)||e instanceof ge&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ge&&(e.overridden=!0)),Kt(s,e,t,n)}class vr extends se{constructor(){const e=W(vr.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Le(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(se.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const r=this._fromType(e),i=this._events.get(t),o=Math.round(Math.max(1/n,1));for(let a=0;a<=o;a++){const c=n*a+t,l=this._exponentialApproach(i.time,i.value,r,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const r=this._events.get(n),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const r=this._events.get(n),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),r=this._events.get(t),i=Math.round(Math.max((t-r.time)*10,1)),o=(t-r.time)/i;for(let a=0;a<=i;a++){const c=o*a+r.time,l=this._exponentialInterpolate(r.time,r.value,t,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Ve(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let r=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&i.type==="setValueAtTime"&&(r=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+r)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),r=this.getTicksAtTime(t);return this.getTimeOfTick(r+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){const r=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(n.time))-r)/(n.time-t.time),a=Math.sqrt(Math.pow(r,2)-2*o*(t.ticks-e)),c=(-r+a)/o,l=(-r-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),r=this.toSeconds(e),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+r)-i}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class Cr extends ge{constructor(){const e=W(Cr.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new vr({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ge.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class Tr extends Ae{constructor(){const e=W(Tr.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new gr,this._tickOffset=new Le,this._ticksAtTime=new Le,this._secondsAtTime=new Le,this.frequency=new Cr({context:this.context,units:e.units,value:e.frequency}),ae(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ae.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),G(t)&&this.setTicksAtTime(t,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),r=this._ticksAtTime.get(t),i={state:"paused",time:t};this._state.add(i);let o=r||n,a=r?r.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==i.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(i),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);const r=this._secondsAtTime.get(e);let i=r||t,o=r?r.seconds:0,a=null;return this._state.forEachBetween(i.time,e+this.sampleTime,c=>{let l=i.time;const u=this._tickOffset.get(c.time);u&&u.time>=i.time&&(o=u.seconds,l=u.time),i.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==n.time&&(a={state:c.state,time:c.time,seconds:o})),i=c}),this._state.remove(n),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),r=this._state.get(t),i=Math.max(n.time,r.time),o=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,n){let r=this._state.get(e);this._state.forEachBetween(e,t,o=>{r&&r.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(r.time,e),o.time-this.sampleTime,n),r=o});let i=null;if(r&&r.state==="started"){const o=Math.max(r.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(r.time),l=a-c;let u=Math.ceil(l)-l;u=je(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(d){i=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class cs extends Ae{constructor(){const e=W(cs.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=X,this._lastUpdate=0,this._state=new gr("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new Tr({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ae(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ae.getDefaults(),{callback:X,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){mo(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),r=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(r+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const r=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,r);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,r)=>{this.callback(n,r)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}bn.mixin(cs);class en extends U{constructor(){const e=W(en.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new ye({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,ae(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class br extends U{constructor(){const e=W(br.getDefaults(),arguments);super(e),this.name="Destination",this.input=new en({context:this.context}),this.output=new ye({context:this.context}),this.volume=this.input.volume,Fs(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),Fs(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}is(s=>{s.destination=new br({context:s})});os(s=>{s.destination.dispose()});class rp extends U{constructor(){super(...arguments),this.name="Listener",this.positionX=new se({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new se({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new se({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new se({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new se({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new se({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new se({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new se({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new se({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(U.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}is(s=>{s.listener=new rp({context:s})});os(s=>{s.listener.dispose()});class Sr extends rt{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=W(Sr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:X,onload:X,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return q(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=X,r=X){return nt(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Q(this.baseUrl+t,n,r))):this._buffers.set(e.toString(),new Q(t,n,r)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Nt extends rn{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class ip extends Ae{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Le,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}is(s=>{s.draw=new ip({context:s})});os(s=>{s.draw.dispose()});class op extends rt{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){q(G(e.time),"Events must have a time property"),q(G(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new ap(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let n,r=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,r=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,r=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,r=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,r=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),r&&this._rebalance(r)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),r=e.right;r&&(e.right=r.left,r.left=e),t!==null?n?t.left=r:t.right=r:this._setRoot(r)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),r=e.left;r&&(e.left=r.right,r.right=e),t!==null?n?t.left=r:t.right=r:this._setRoot(r)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let r=1;r<t.length;r++)t[r].low>n.low&&(n=t[r]);return n.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(r=>{r.event&&t(r.event)})}return this}forEachFrom(e,t){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(r=>{r.event&&t(r.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class ap{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class cp extends rt{constructor(e){super(),this.name="TimelineValue",this._timeline=new Le({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class $t extends U{constructor(){super(W($t.getDefaults(),arguments,["context"]))}connect(e,t=0,n=0){return yr(this,e,t,n),this}}class kn extends $t{constructor(){const e=W(kn.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,$e(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Md(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ge.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let r=0,i=t;r<i;r++){const o=r/(i-1)*2-1;n[r]=e(o,r)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(n=>n.includes(e));q(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class kr extends $t{constructor(){const e=W(kr.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new kn({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign($t.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class dt{constructor(e,t){this.id=dt._eventId++,this._remainderTime=0;const n=Object.assign(dt.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=Math.floor(n.time),this._remainderTime=n.time-this.time}static getDefaults(){return{callback:X,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}dt._eventId=0;class xr extends dt{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(xr.getDefaults(),t);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},dt.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return Zn(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Nt(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){Zn(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Nt(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Wt(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class ls extends Ae{constructor(){const e=W(ls.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new cp(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Le,this._repeatedEvents=new op,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new cs({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),ae(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Ae.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const n=t%(this._swingTicks*2)/(this._swingTicks*2),r=Math.sin(n*Math.PI)*this._swingAmount;e+=new Nt(this.context,this._swingTicks*2/3).toSeconds()*r}ii(!0),this._timeline.forEachAtTime(t,n=>n.invoke(e)),ii(!1)}schedule(e,t){const n=new dt(this,{callback:e,time:new rn(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,r=1/0){const i=new xr(this,{callback:e,duration:new qe(this.context,r).toTicks(),interval:new qe(this.context,t).toTicks(),time:new rn(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const n=new dt(this,{callback:e,once:!0,time:new rn(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new Nt(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let n;return G(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){$e(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new qe(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new qe(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Nt(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Nt(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(t),r=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),i=t+r;this.emit("stop",i),this._clock.setTicksAtTime(e,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),n=this.getTicksAtTime(t),r=e-n%e;return this._clock.nextTickTime(r,t)}}syncSignal(e,t){const n=this.now();let r=this.bpm,i=1/(60/r.getValueAtTime(n)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/i,l=new ye(c),u=new kr(-1),h=new ye(c);r.chain(l,u,h),r=h,i=1/i,o=[l,u,h]}t||(e.getValueAtTime(n)!==0?t=e.getValueAtTime(n)/i:t=0);const a=new ye(t);return r.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.nodes.forEach(r=>r.dispose()),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),To(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}bn.mixin(ls);is(s=>{s.transport=new ls({context:s})});os(s=>{s.transport.dispose()});class Pe extends U{constructor(e){super(e),this.input=void 0,this._state=new gr("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=X,this._syncedStop=X,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new en({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,ae(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,onstop:X,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let r=Ve(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(r=this._clampToCurrentTime(r),!this._synced&&this._state.getValueAtTime(r)==="started")q(Wt(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,t,n);else if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const i=this._state.get(r);i&&(i.offset=this.toSeconds(Vt(t,0)),i.duration=n?this.toSeconds(n):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,n)},r);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else mo(this.context),this._start(r,t,n);return this}stop(e){let t=Ve(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||G(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Wt(t,0)){const n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){const r=t-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-r),this._start(e,this.toSeconds(n.offset)+r,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=X,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class us extends qt{constructor(){const e=W(us.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Kt(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new se({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Q(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(qt.getDefaults(),{url:new Q,loop:!1,loopEnd:0,loopStart:0,onload:X,onerror:X,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,r=1){q(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,r),this.loop?t=Vt(t,this.loopStart):t=Vt(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;Ns(o,a)&&(o=(o-c)%l+c),je(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Zn(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),G(n)){let a=this.toSeconds(n);a=Math.max(a,0),this.stop(i+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function xt(s,e){return he(this,void 0,void 0,function*(){const t=e/s.context.sampleRate,n=new fr(1,t,s.context.sampleRate);return new s.constructor(Object.assign(s.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class wr extends qt{constructor(){const e=W(wr.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Kt(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new se({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new se({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),ae(this,["frequency","detune"])}static getDefaults(){return Object.assign(qt.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ce extends Pe{constructor(){const e=W(ce.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new ge({context:this.context,units:"frequency",value:e.frequency}),ae(this,"frequency"),this.detune=new ge({context:this.context,units:"cents",value:e.detune}),ae(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Pe.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new wr({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return ce._periodicWaveCache.find(t=>t.phase===this._phase&&$d(t.partials,this._partials));{const e=ce._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(G(n)){const{partials:r,wave:i}=n;this._wave=i,this._partials=r,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[r,i]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(r,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),ce._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:r,type:this._type,wave:this._wave}),ce._periodicWaveCache.length>100&&ce._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){ht(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const r=new Float32Array(e);this._partials.forEach((i,o)=>r[o]=i),this._partials=Array.from(r),this.type=this._type}}_getRealImaginary(e,t){let r=2048;const i=new Float32Array(r),o=new Float32Array(r);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,r=a,this._partials.length===0)return[i,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),r=a):this._partialCount=0,this._partials=[]}for(let c=1;c<r;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(i[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(i[c]=0,o[c]=0)}return[i,o]}_inverseFFT(e,t,n){let r=0;const i=e.length;for(let o=0;o<i;o++)r+=e[o]*Math.cos(o*n)+t[o]*Math.sin(o*n);return r}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const r=Math.PI*2,i=32;for(let o=0;o<i;o++)n=Math.max(this._inverseFFT(e,t,o/i*r),n);return zd(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return he(this,arguments,void 0,function*(e=1024){return xt(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ce._periodicWaveCache=[];class lp extends $t{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new kn({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ut extends ge{constructor(){const e=W(Ut.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new ye({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ge.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class hs extends Pe{constructor(){const e=W(hs.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new lp({context:this.context}),this._modulationNode=new ye({context:this.context}),this._carrier=new ce({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ce({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Ut({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ae(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ce.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return he(this,arguments,void 0,function*(e=1024){return xt(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class ds extends Pe{constructor(){const e=W(ds.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new ye({context:this.context,gain:0}),this._carrier=new ce({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ge({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new ce({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Ut({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Ut({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ae(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ce.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return he(this,arguments,void 0,function*(e=1024){return xt(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class xn extends Pe{constructor(){const e=W(xn.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new ye({context:this.context,gain:0}),this._thresh=new kn({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new ge({context:this.context,units:"audioRange",value:e.width}),this._triangle=new ce({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ae(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Pe.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return he(this,arguments,void 0,function*(e=1024){return xt(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class ps extends Pe{constructor(){const e=W(ps.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new ge({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ge({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,ae(this,["frequency","detune"])}static getDefaults(){return Object.assign(ce.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((r,i)=>r.detune.value=t+n*i)}}get count(){return this._oscillators.length}set count(e){if(ht(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new ce({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):X});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return he(this,arguments,void 0,function*(e=1024){return xt(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class fs extends Pe{constructor(){const e=W(fs.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Ut({context:this.context,value:2}),this._pulse=new xn({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ce({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ae(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Pe.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return he(this,arguments,void 0,function*(e=1024){return xt(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const ai={am:hs,fat:ps,fm:ds,oscillator:ce,pulse:xn,pwm:fs};class Xn extends Pe{constructor(){const e=W(Xn.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new ge({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ge({context:this.context,units:"cents",value:e.detune}),ae(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(ce.getDefaults(),ds.getDefaults(),hs.getDefaults(),ps.getDefaults(),xn.getDefaults(),fs.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=ai[e],n=this.now();if(this._oscillator){const r=this._oscillator;r.stop(n),this.context.setTimeout(()=>r.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof ai[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&Tt(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&Tt(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&nt(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return he(this,arguments,void 0,function*(e=1024){return xt(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function xo(s,e=1/0){const t=new WeakMap;return function(n,r){Reflect.defineProperty(n,r,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){ht(i,s,e),t.set(this,i)}})}}function it(s,e=1/0){const t=new WeakMap;return function(n,r){Reflect.defineProperty(n,r,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){ht(this.toSeconds(i),s,e),t.set(this,i)}})}}class ms extends Pe{constructor(){const e=W(ms.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Q({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Pe.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:X,onerror:X,playbackRate:1,reverse:!1})}load(e){return he(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=X){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=Vt(t,this._loopStart):t=Vt(t,0);const r=this.toSeconds(t),i=n;n=Vt(n,Math.max(this._buffer.duration-r,0));let o=this.toSeconds(n);o=o/this._playbackRate,e=this.toSeconds(e);const a=new us({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Ve(i)?a.start(e,r):a.start(e,r,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){var r;(r=[...this._activeSources].pop())===null||r===void 0||r.stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){const r=this.toSeconds(e);this._stop(n),this._start(n,r)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&ht(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&ht(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(r=>r.cancelStop())),this._activeSources.forEach(r=>{r.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Ye([it(0)],ms.prototype,"fadeIn",void 0);Ye([it(0)],ms.prototype,"fadeOut",void 0);class mt extends U{constructor(){const e=W(mt.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new ge({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(U.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(nt(e))return e;{let n;for(n in En)if(En[n][t]===e)return n;return e}}_setCurve(e,t,n){if(nt(n)&&Reflect.has(En,n)){const r=En[n];vt(r)?e!=="_decayCurve"&&(this[e]=r[t]):this[e]=r}else if($e(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let r=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/r;r=(1-o)/a}if(r<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,r,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,r,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,r,t)}if(i&&this.sustain<1){const a=t*this.sustain,c=e+r;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,i+c):this._sig.exponentialApproachValueAtTime(a,c,i)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(q($e(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return yr(this,e,t,n),this}asArray(){return he(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,n=new fr(1,t,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=r+this.toSeconds(this.release),o=i*.1,a=i+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:n}));return c._sig.toDestination(),c.triggerAttackRelease(t*(r+o)/a,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Ye([it(0)],mt.prototype,"attack",void 0);Ye([it(0)],mt.prototype,"decay",void 0);Ye([xo(0,1)],mt.prototype,"sustain",void 0);Ye([it(0)],mt.prototype,"release",void 0);const En=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));const r=[],i=6.4;for(e=0;e<127;e++){t=e/127;const d=Math.sin(t*(Math.PI*2)*i-Math.PI/2)+1;r[e]=d/10+t*.83}r[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/127;const d=Math.pow(t,3)*4+.2,p=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(p*(1-t))}function u(d){const p=new Array(d.length);for(let f=0;f<d.length;f++)p[f]=1-d[f];return p}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:n,Out:h(n)},exponential:"exponential",linear:"linear",ripple:{In:r,Out:u(r)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class zt extends U{constructor(){const e=W(zt.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new en({context:this.context,volume:e.volume}),this.volume=this._volume.volume,ae(this,"volume")}static getDefaults(){return Object.assign(U.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...r)=>{const i=r[t],o=this.context.transport.schedule(a=>{r[t]=a,n.apply(this,r)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,n,r){const i=this.toSeconds(n),o=this.toSeconds(t);return this.triggerAttack(e,i,r),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Gt extends zt{constructor(){const e=W(Gt.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(zt.getDefaults(),{detune:0,onsilence:X,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const r=this.toSeconds(t);return this._triggerEnvelopeAttack(r,n),this.setNote(e,r),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),r=e instanceof Fe?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,i,n)}else this.frequency.setValueAtTime(r,n);return this}}Ye([it(0)],Gt.prototype,"portamento",void 0);class Ar extends mt{constructor(){super(W(Ar.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ye({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Hn extends Gt{constructor(){const e=W(Hn.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Xn(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Ar(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),ae(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Gt.getDefaults(),{envelope:Object.assign(oi(mt.getDefaults(),Object.keys(U.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(oi(Xn.getDefaults(),[...Object.keys(Pe.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+r)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class gs extends Hn{constructor(){const e=W(gs.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,ae(this,["oscillator","envelope"])}static getDefaults(){return Ft(Gt.getDefaults(),Hn.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),r=this.toFrequency(e instanceof Fe?e.toFrequency():e),i=r*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(r,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Ye([xo(0)],gs.prototype,"octaves",void 0);Ye([it(0)],gs.prototype,"pitchDecay",void 0);const wo=new Set;function Rr(s){wo.add(s)}function Ao(s,e){const t=`registerProcessor("${s}", ${e})`;wo.add(t)}const up=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;Rr(up);const hp=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;Rr(hp);const dp=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;Rr(dp);const pp="feedback-comb-filter",fp=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Ao(pp,fp);class _s extends zt{constructor(){const e=W(_s.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(n=>{const r=parseInt(n,10);if(q(Rn(n)||Tt(r)&&isFinite(r),`url key is neither a note or midi pitch: ${n}`),Rn(n)){const i=new Fe(this.context,n).toMidi();t[i]=e.urls[n]}else Tt(r)&&isFinite(r)&&(t[r]=e.urls[r])}),this._buffers=new Sr({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(zt.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:X,onerror:X,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=ko(new Fe(this.context,r).toFrequency()),o=Math.round(i),a=i-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=So(c+a),d=new us({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,n),$e(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const p=this._activeSources.get(o),f=p.indexOf(d);f!==-1&&p.splice(f,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const r=new Fe(this.context,n).toMidi();if(this._activeSources.has(r)&&this._activeSources.get(r).length){const i=this._activeSources.get(r);t=this.toSeconds(t),i.forEach(o=>{o.stop(t)}),this._activeSources.set(r,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,r=1){const i=this.toSeconds(n);return this.triggerAttack(e,i,r),$e(t)?(q($e(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,i+this.toSeconds(c))})):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,n){if(q(Rn(e)||isFinite(e),`note must be a pitch or midi: ${e}`),Rn(e)){const r=new Fe(this.context,e).toMidi();this._buffers.add(r,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}Ye([it(0)],_s.prototype,"attack",void 0);Ye([it(0)],_s.prototype,"release",void 0);class Er extends U{constructor(){const e=W(Er.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new se({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",ae(this,"pan")}static getDefaults(){return Object.assign(U.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const mp="bit-crusher",gp=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Ao(mp,gp);class ue extends U{constructor(){const e=W(ue.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new ye({context:this.context}),ue._allSolos.has(this.context)||ue._allSolos.set(this.context,new Set),ue._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(U.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),ue._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){ue._soloed.has(this.context)||ue._soloed.set(this.context,new Set),ue._soloed.get(this.context).add(this)}_removeSolo(){ue._soloed.has(this.context)&&ue._soloed.get(this.context).delete(this)}_isSoloed(){return ue._soloed.has(this.context)&&ue._soloed.get(this.context).has(this)}_noSolos(){return!ue._soloed.has(this.context)||ue._soloed.has(this.context)&&ue._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),ue._allSolos.get(this.context).delete(this),this._removeSolo(),this}}ue._allSolos=new Map;ue._soloed=new Map;class Or extends U{constructor(){const e=W(Or.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new Er({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new en({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,ae(this,["pan","volume"])}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Dt extends U{constructor(){const e=W(Dt.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new ue({solo:e.solo,context:this.context}),this._panVol=this.output=new Or({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),ae(this,["pan","volume"])}static getDefaults(){return Object.assign(U.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Dt.buses.has(e)||Dt.buses.set(e,new ye({context:this.context})),Dt.buses.get(e)}send(e,t=0){const n=this._getBus(e),r=new ye({context:this.context,units:"decibels",gain:t});return this.connect(r),r.connect(n),r}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Dt.buses=new Map;function Ro(){return De().now()}De().transport;De().destination;De().destination;De().listener;De().draw;De();class _p{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return yp(e).buffer}}function yp(s){let e=0;for(const r of s)e+=r.byteLength;const t=new Uint8Array(e);let n=0;for(const r of s){const i=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);t.set(i,n),n+=r.byteLength}return t}function Eo(s){return new vp(s).unpack()}function Oo(s){const e=new Cp,t=e.pack(s);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class vp{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let n=0,r="",i,o;for(;n<e;)i=t[n],i<160?(o=i,n++):(i^192)<32?(o=(i&31)<<6|t[n+1]&63,n+=2):(i^224)<16?(o=(i&15)<<12|(t[n+1]&63)<<6|t[n+2]&63,n+=3):(o=(i&7)<<18|(t[n+1]&63)<<12|(t[n+2]&63)<<6|t[n+3]&63,n+=4),r+=String.fromCodePoint(o);return this.index+=e,r}unpack_array(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=this.unpack();return t}unpack_map(e){const t={};for(let n=0;n<e;n++){const r=this.unpack();t[r]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,n=(e>>23&255)-127,r=e&8388607|8388608;return(t===0?1:-1)*r*2**(n-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),n=e>>31,r=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(r-20)+t*2**(r-52);return(n===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class Cp{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const n=this.pack_array(e);if(n instanceof Promise)return n.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const n=e;this.pack_bin(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(n=>{this.pack_bin(new Uint8Array(n)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const n=this.pack_object(e);if(n instanceof Promise)return n.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),n=t.length;if(n<=15)this.pack_uint8(176+n);else if(n<=65535)this._bufferBuilder.append(216),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const n=r=>{if(r<t){const i=this.pack(e[r]);return i instanceof Promise?i.then(()=>n(r+1)):n(r+1)}};return n(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const n=Math.floor(Math.log(e)/Math.LN2),r=e/2**n-1,i=Math.floor(r*2**52),o=2**32,a=t<<31|n+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const t=Object.keys(e),n=t.length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this._bufferBuilder.append(222),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(n);else throw new Error("Invalid length");const r=i=>{if(i<t.length){const o=t[i];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>r(i+1))}return r(i+1)}};return r(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,n=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),n=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}constructor(){this._bufferBuilder=new _p,this._textEncoder=new TextEncoder}}let Io=!0,Mo=!0;function Mn(s,e,t){const n=s.match(e);return n&&n.length>=t&&parseInt(n[t],10)}function wt(s,e,t){if(!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=t(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const i=n.removeEventListener;n.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(a))return i.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function Tp(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Io=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function bp(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(Mo=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Po(){if(typeof window=="object"){if(Io)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ir(s,e){Mo&&console.warn(s+" is deprecated, please use "+e+" instead.")}function Sp(s){const e={browser:null,version:null};if(typeof s>"u"||!s.navigator||!s.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=s;if(t.userAgentData&&t.userAgentData.brands){const n=t.userAgentData.brands.find(r=>r.brand==="Chromium");if(n)return{browser:"chrome",version:parseInt(n.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=Mn(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)e.browser="chrome",e.version=Mn(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(s.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Mn(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function ci(s){return Object.prototype.toString.call(s)==="[object Object]"}function No(s){return ci(s)?Object.keys(s).reduce(function(e,t){const n=ci(s[t]),r=n?No(s[t]):s[t],i=n&&!Object.keys(r).length;return r===void 0||i?e:Object.assign(e,{[t]:r})},{}):s}function Vs(s,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?Vs(s,s.get(e[n]),t):n.endsWith("Ids")&&e[n].forEach(r=>{Vs(s,s.get(r),t)})}))}function li(s,e,t){const n=t?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const i=[];return s.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{s.forEach(a=>{a.type===n&&a.trackId===o.id&&Vs(s,a,r)})}),r}const ui=Po;function Do(s,e){const t=s&&s.navigator;if(!t.mediaDevices)return;const n=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(d,p){return d?d+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){c.optional=c.optional||[];let d={};typeof u.ideal=="number"?(d[h("min",l)]=u.ideal,c.optional.push(d),d={},d[h("max",l)]=u.ideal,c.optional.push(d)):(d[h("",l)]=u.ideal,c.optional.push(d))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(d=>{u[d]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(d,l)]=u[d])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,h,d){h in u&&!(d in u)&&(u[d]=u[h],delete u[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=n(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return t.mediaDevices.enumerateDevices().then(d=>{d=d.filter(f=>f.kind==="videoinput");let p=d.find(f=>h.some(m=>f.label.toLowerCase().includes(m)));return!p&&d.length&&h.includes("back")&&(p=d[d.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=n(a.video),ui("chrome: "+JSON.stringify(a)),c(a)})}a.video=n(a.video)}return ui("chrome: "+JSON.stringify(a)),c(a)},i=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{t.webkitGetUserMedia(u,c,h=>{l&&l(i(h))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function Fo(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function Vo(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;s.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):i={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(r=>{let i;s.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===r.id):i={track:r};const o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else wt(s,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Lo(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const e=function(r,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=r.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:r}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const i=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(a){i.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],t.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const e=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function jo(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=s.RTCPeerConnection.prototype.addTrack;n&&(s.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),s.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>li(o,i.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r}),wt(s,"track",n=>(n.receiver._pc=n.srcElement,n)),s.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>li(i,r.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const n=arguments[0];let r,i,o;return this.getSenders().forEach(a=>{a.track===n&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===n&&(i?o=!0:i=a),a.track===n)),o||r&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Bo(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)};const r=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function Wo(s,e){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Bo(s);const t=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const n=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(p=>p.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new s.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}n.apply(this,[u])};const r=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},s.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const f=this._streams[h.id];if(f)f.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new s.MediaStream([u]);this._streams[h.id]=m,this._reverseStreams[m.id]=h,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function i(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const p=l._reverseStreams[d],f=l._streams[p.id];h=h.replace(new RegExp(f.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const p=l._reverseStreams[d],f=l._streams[p.id];h=h.replace(new RegExp(p.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=s.RTCPeerConnection.prototype[l],h={[l](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[f=>{const m=i(this,f);d[0].apply(null,[m])},f=>{d[1]&&d[1].apply(null,f)},arguments[2]]):u.apply(this,arguments).then(f=>i(this,f))}};s.RTCPeerConnection.prototype[l]=h[l]});const a=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:i(this,l)}}),s.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>u.track===m)&&(d=this._streams[p])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ls(s,e){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=s.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};s.RTCPeerConnection.prototype[t]=r[t]})}function qo(s,e){wt(s,"negotiationneeded",t=>{const n=t.target;if(!((e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return t})}const hi=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:qo,shimAddTrackRemoveTrack:Wo,shimAddTrackRemoveTrackWithNative:Bo,shimGetSendersWithDtmf:Lo,shimGetUserMedia:Do,shimMediaStream:Fo,shimOnTrack:Vo,shimPeerConnection:Ls,shimSenderReceiverGetStats:jo},Symbol.toStringTag,{value:"Module"}));function $o(s,e){const t=s&&s.navigator,n=s&&s.MediaStreamTrack;if(t.getUserMedia=function(r,i,o){Ir("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(r).then(i,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},n&&n.prototype.getSettings){const o=n.prototype.getSettings;n.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(n&&n.prototype.applyConstraints){const o=n.prototype.applyConstraints;n.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function kp(s,e){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,s.navigator.mediaDevices.getUserMedia(n)})}function Uo(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function js(s,e){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const i=s.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=o[r]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[i,o,a]=arguments;return n.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(o,a)}}function zo(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const e=s.RTCPeerConnection.prototype.getSenders;e&&(s.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});const t=s.RTCPeerConnection.prototype.addTrack;t&&(s.RTCPeerConnection.prototype.addTrack=function(){const r=t.apply(this,arguments);return r._pc=this,r}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Go(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const e=s.RTCPeerConnection.prototype.getReceivers;e&&(s.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n}),wt(s,"track",t=>(t.receiver._pc=t.srcElement,t)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Yo(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){Ir("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function Zo(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function Xo(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.addTransceiver;e&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(r){const{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function Ho(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const e=s.RTCRtpSender.prototype.getParameters;e&&(s.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Jo(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Qo(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const di=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Xo,shimCreateAnswer:Qo,shimCreateOffer:Jo,shimGetDisplayMedia:kp,shimGetParameters:Ho,shimGetUserMedia:$o,shimOnTrack:Uo,shimPeerConnection:js,shimRTCDataChannel:Zo,shimReceiverGetStats:Go,shimRemoveStream:Yo,shimSenderGetStats:zo},Symbol.toStringTag,{value:"Module"}));function Ko(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},s.RTCPeerConnection.prototype.addTrack=function(n,...r){return r&&r.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{r.includes(i.track)&&this.removeTrack(i)})})}}function ea(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const i=new Event("addstream");i.stream=r,this.dispatchEvent(i)})})}});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,n.dispatchEvent(o)})}),e.apply(n,arguments)}}}function ta(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype,t=e.createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=t.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d};let a=function(c,l,u){const h=r.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=a}function na(s){const e=s&&s.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,n=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=r=>n(sa(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,r,i){e.mediaDevices.getUserMedia(n).then(r,i)}).bind(e))}function sa(s){return s&&s.video!==void 0?Object.assign({},s,{video:No(s.video)}):s}function ra(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection;s.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let o=0;o<n.iceServers.length;o++){let a=n.iceServers[o];a.urls===void 0&&a.url?(Ir("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(n.iceServers[o])}n.iceServers=i}return new e(n,r)},s.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function ia(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function oa(s){const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function aa(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}const pi=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:aa,shimCallbacksAPI:ta,shimConstraints:sa,shimCreateOfferLegacy:oa,shimGetUserMedia:na,shimLocalStreamsAPI:Ko,shimRTCIceServerUrls:ra,shimRemoteStreamsAPI:ea,shimTrackEventTransceiver:ia},Symbol.toStringTag,{value:"Module"}));var Ss={exports:{}},fi;function xp(){return fi||(fi=1,function(s){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(n=>n.trim())},e.splitSections=function(t){return t.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(t){const n=e.splitSections(t);return n&&n[0]},e.getMediaSections=function(t){const n=e.splitSections(t);return n.shift(),n},e.matchPrefix=function(t,n){return e.splitLines(t).filter(r=>r.indexOf(n)===0)},e.parseCandidate=function(t){let n;t.indexOf("a=candidate:")===0?n=t.substring(12).split(" "):n=t.substring(10).split(" ");const r={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let i=8;i<n.length;i+=2)switch(n[i]){case"raddr":r.relatedAddress=n[i+1];break;case"rport":r.relatedPort=parseInt(n[i+1],10);break;case"tcptype":r.tcpType=n[i+1];break;case"ufrag":r.ufrag=n[i+1],r.usernameFragment=n[i+1];break;default:r[n[i]]===void 0&&(r[n[i]]=n[i+1]);break}return r},e.writeCandidate=function(t){const n=[];n.push(t.foundation);const r=t.component;r==="rtp"?n.push(1):r==="rtcp"?n.push(2):n.push(r),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);const i=t.type;return n.push("typ"),n.push(i),i!=="host"&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let n=t.substring(9).split(" ");const r={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),r.name=n[0],r.clockRate=parseInt(n[1],10),r.channels=n.length===3?parseInt(n[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(t){let n=t.payloadType;t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType);const r=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(t){const n=t.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const n={};let r;const i=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)r=i[o].trim().split("="),n[r[0].trim()]=r[1];return n},e.writeFmtp=function(t){let n="",r=t.payloadType;if(t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const i=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?i.push(o+"="+t.parameters[o]):i.push(o)}),n+="a=fmtp:"+r+" "+i.join(";")+`\r
`}return n},e.parseRtcpFb=function(t){const n=t.substring(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},e.writeRtcpFb=function(t){let n="",r=t.payloadType;return t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(i=>{n+="a=rtcp-fb:"+r+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),n},e.parseSsrcMedia=function(t){const n=t.indexOf(" "),r={ssrc:parseInt(t.substring(7,n),10)},i=t.indexOf(":",n);return i>-1?(r.attribute=t.substring(n+1,i),r.value=t.substring(i+1)):r.attribute=t.substring(n+1),r},e.parseSsrcGroup=function(t){const n=t.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(r=>parseInt(r,10))}},e.getMid=function(t){const n=e.matchPrefix(t,"a=mid:")[0];if(n)return n.substring(6)},e.parseFingerprint=function(t){const n=t.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},e.getDtlsParameters=function(t,n){return{role:"auto",fingerprints:e.matchPrefix(t+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,n){let r="a=setup:"+n+`\r
`;return t.fingerprints.forEach(i=>{r+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),r},e.parseCryptoLine=function(t){const n=t.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const n=t.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,n){return e.matchPrefix(t+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,n){const r=e.matchPrefix(t+n,"a=ice-ufrag:")[0],i=e.matchPrefix(t+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(t){let n="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(n+=`a=ice-lite\r
`),n},e.parseRtpParameters=function(t){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");n.profile=i[2];for(let a=3;a<i.length;a++){const c=i[a],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),n.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{n.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return n.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),n},e.writeRtpDescription=function(t,n){let r="";r+="m="+t+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let i=0;return n.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(r+="a=maxptime:"+i+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(t){const n=[],r=e.parseRtpParameters(t),i=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(d=>d.substring(17).split(" ").map(f=>parseInt(f,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(d=>{if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(d.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),n.push(p),i&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(p))}}),n.length===0&&c&&n.push({ssrc:c});let h=e.matchPrefix(t,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,n.forEach(d=>{d.maxBitrate=h})),n},e.parseRtcpParameters=function(t){const n={},r=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=e.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=i.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return n.mux=o.length>0,n},e.writeRtcpParameters=function(t){let n="";return t.reducedSize&&(n+=`a=rtcp-rsize\r
`),t.mux&&(n+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(n+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),n},e.parseMsid=function(t){let n;const r=e.matchPrefix(t,"a=msid:");if(r.length===1)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return n=i[0].value.split(" "),{stream:n[0],track:n[1]}},e.parseSctpDescription=function(t){const n=e.parseMLine(t),r=e.matchPrefix(t,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(t,n){let r=[];return t.protocol!=="DTLS/SCTP"?r=["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:r=["m="+t.kind+" 9 "+t.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&r.push("a=max-message-size:"+n.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,n,r){let i;const o=n!==void 0?n:2;return t?i=t:i=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,n){const r=e.splitLines(t);for(let i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substring(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const r=e.splitLines(t)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(t){const r=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const n=e.splitLines(t);for(let r=0;r<n.length;r++)if(n[r].length<2||n[r].charAt(1)!=="=")return!1;return!0},s.exports=e}(Ss)),Ss.exports}var ca=xp();const Lt=Ci(ca),wp=Ca({__proto__:null,default:Lt},[ca]);function Pn(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const e=s.RTCIceCandidate;s.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substring(2)),n.candidate&&n.candidate.length){const r=new e(n),i=Lt.parseCandidate(n.candidate);for(const o in i)o in r||Object.defineProperty(r,o,{value:i[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(n)},s.RTCIceCandidate.prototype=e.prototype,wt(s,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new s.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Bs(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||wt(s,"icecandidate",e=>{if(e.candidate){const t=Lt.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Nn(s,e){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=Lt.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Lt.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},n=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Lt.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=n(arguments[0]),l=r(c),u=i(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return h}}),this._sctp=d}return o.apply(this,arguments)}}function Dn(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function e(n,r){const i=n.send;n.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(n.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return i.apply(n,arguments)}}const t=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const r=t.apply(this,arguments);return e(r,this),r},wt(s,"datachannel",n=>(e(n.channel,n.target),n))}function Ws(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const e=s.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const i=r.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",r);i.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function qs(s,e){if(!s.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&r instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return t.apply(this,arguments)}}function Fn(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Vn(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(s.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return t.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?t.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const Ap=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:qs,shimAddIceCandidateNullOrEmpty:Fn,shimConnectionState:Ws,shimMaxMessageSize:Nn,shimParameterlessSetLocalDescription:Vn,shimRTCIceCandidate:Pn,shimRTCIceCandidateRelayProtocol:Bs,shimSendThrowTypeError:Dn},Symbol.toStringTag,{value:"Module"}));function Rp({window:s}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=Po,n=Sp(s),r={browserDetails:n,commonShim:Ap,extractVersion:Mn,disableLog:Tp,disableWarnings:bp,sdp:wp};switch(n.browser){case"chrome":if(!hi||!Ls||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),r;if(n.version===null)return t("Chrome shim can not determine version, not shimming."),r;t("adapter.js shimming chrome."),r.browserShim=hi,Fn(s,n),Vn(s),Do(s,n),Fo(s),Ls(s,n),Vo(s),Wo(s,n),Lo(s),jo(s),qo(s,n),Pn(s),Bs(s),Ws(s),Nn(s,n),Dn(s),qs(s,n);break;case"firefox":if(!di||!js||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),r;t("adapter.js shimming firefox."),r.browserShim=di,Fn(s,n),Vn(s),$o(s,n),js(s,n),Uo(s),Yo(s),zo(s),Go(s),Zo(s),Xo(s),Ho(s),Jo(s),Qo(s),Pn(s),Ws(s),Nn(s,n),Dn(s);break;case"safari":if(!pi||!e.shimSafari)return t("Safari shim is not included in this adapter release."),r;t("adapter.js shimming safari."),r.browserShim=pi,Fn(s,n),Vn(s),ra(s),oa(s),ta(s),Ko(s),ea(s),ia(s),na(s),aa(s),Pn(s),Bs(s),Nn(s,n),Dn(s),qs(s,n);break;default:t("Unsupported browser!");break}return r}const mi=Rp({window:typeof window>"u"?void 0:window});function At(s,e,t,n){Object.defineProperty(s,e,{get:t,set:n,enumerable:!0,configurable:!0})}class la{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],n=e.byteLength,r=Math.ceil(n/this.chunkedMTU);let i=0,o=0;for(;o<n;){const a=Math.min(n,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:i,data:c,total:r};t.push(l),o=a,i++}return this._dataCount++,t}}}function Ep(s){let e=0;for(const r of s)e+=r.byteLength;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.byteLength;return t}const ks=mi.default||mi,sn=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const s=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(s)?s==="chrome"?e>=this.minChromeVersion:s==="firefox"?e>=this.minFirefoxVersion:s==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return ks.browserDetails.browser}getVersion(){return ks.browserDetails.version||0}isUnifiedPlanSupported(){const s=this.getBrowser(),e=ks.browserDetails.version||0;if(s==="chrome"&&e<this.minChromeVersion)return!1;if(s==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,n=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),n=!0}catch{}finally{t&&t.close()}return n}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Op=s=>!s||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(s),ua=()=>Math.random().toString(36).slice(2),gi={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class Ip extends la{noop(){}blobToArrayBuffer(e,t){const n=new FileReader;return n.onload=function(r){r.target&&t(r.target.result)},n.readAsArrayBuffer(e),n}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=gi,this.browser=sn.getBrowser(),this.browserVersion=sn.getVersion(),this.pack=Oo,this.unpack=Eo,this.supports=function(){const t={browser:sn.isBrowserSupported(),webRTC:sn.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let n;try{n=new RTCPeerConnection(gi),t.audioVideo=!0;let r;try{r=n.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!r.ordered;try{r.binaryType="blob",t.binaryBlob=!sn.isIOS}catch{}}catch{}finally{r&&r.close()}}catch{}finally{n&&n.close()}return t}(),this.validateId=Op,this.randomToken=ua}}const we=new Ip,Mp="PeerJS: ";var _i;(function(s){s[s.Disabled=0]="Disabled",s[s.Errors=1]="Errors",s[s.Warnings=2]="Warnings",s[s.All=3]="All"})(_i||(_i={}));class Pp{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const n=[Mp,...t];for(const r in n)n[r]instanceof Error&&(n[r]="("+n[r].name+") "+n[r].message);e>=3?console.log(...n):e>=2?console.warn("WARNING",...n):e>=1&&console.error("ERROR",...n)}constructor(){this._logLevel=0}}var M=new Pp,Mr={},Np=Object.prototype.hasOwnProperty,ke="~";function hn(){}Object.create&&(hn.prototype=Object.create(null),new hn().__proto__||(ke=!1));function Dp(s,e,t){this.fn=s,this.context=e,this.once=t||!1}function ha(s,e,t,n,r){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Dp(t,n||s,r),o=ke?ke+e:e;return s._events[o]?s._events[o].fn?s._events[o]=[s._events[o],i]:s._events[o].push(i):(s._events[o]=i,s._eventsCount++),s}function Ln(s,e){--s._eventsCount===0?s._events=new hn:delete s._events[e]}function ve(){this._events=new hn,this._eventsCount=0}ve.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)Np.call(t,n)&&e.push(ke?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};ve.prototype.listeners=function(e){var t=ke?ke+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o};ve.prototype.listenerCount=function(e){var t=ke?ke+e:e,n=this._events[t];return n?n.fn?1:n.length:0};ve.prototype.emit=function(e,t,n,r,i,o){var a=ke?ke+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var d=c.length,p;for(h=0;h<d;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,n);break;case 4:c[h].fn.call(c[h].context,t,n,r);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];c[h].fn.apply(c[h].context,u)}}return!0};ve.prototype.on=function(e,t,n){return ha(this,e,t,n,!1)};ve.prototype.once=function(e,t,n){return ha(this,e,t,n,!0)};ve.prototype.removeListener=function(e,t,n,r){var i=ke?ke+e:e;if(!this._events[i])return this;if(!t)return Ln(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!r||o.once)&&(!n||o.context===n)&&Ln(this,i);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||r&&!o[a].once||n&&o[a].context!==n)&&c.push(o[a]);c.length?this._events[i]=c.length===1?c[0]:c:Ln(this,i)}return this};ve.prototype.removeAllListeners=function(e){var t;return e?(t=ke?ke+e:e,this._events[t]&&Ln(this,t)):(this._events=new hn,this._eventsCount=0),this};ve.prototype.off=ve.prototype.removeListener;ve.prototype.addListener=ve.prototype.on;ve.prefixed=ke;ve.EventEmitter=ve;Mr=ve;var Rt={};At(Rt,"ConnectionType",()=>Xe);At(Rt,"PeerErrorType",()=>ie);At(Rt,"BaseConnectionErrorType",()=>dn);At(Rt,"DataConnectionErrorType",()=>pn);At(Rt,"SerializationType",()=>Yt);At(Rt,"SocketEventType",()=>Ze);At(Rt,"ServerMessageType",()=>fe);var Xe;(function(s){s.Data="data",s.Media="media"})(Xe||(Xe={}));var ie;(function(s){s.BrowserIncompatible="browser-incompatible",s.Disconnected="disconnected",s.InvalidID="invalid-id",s.InvalidKey="invalid-key",s.Network="network",s.PeerUnavailable="peer-unavailable",s.SslUnavailable="ssl-unavailable",s.ServerError="server-error",s.SocketError="socket-error",s.SocketClosed="socket-closed",s.UnavailableID="unavailable-id",s.WebRTC="webrtc"})(ie||(ie={}));var dn;(function(s){s.NegotiationFailed="negotiation-failed",s.ConnectionClosed="connection-closed"})(dn||(dn={}));var pn;(function(s){s.NotOpenYet="not-open-yet",s.MessageToBig="message-too-big"})(pn||(pn={}));var Yt;(function(s){s.Binary="binary",s.BinaryUTF8="binary-utf8",s.JSON="json",s.None="raw"})(Yt||(Yt={}));var Ze;(function(s){s.Message="message",s.Disconnected="disconnected",s.Error="error",s.Close="close"})(Ze||(Ze={}));var fe;(function(s){s.Heartbeat="HEARTBEAT",s.Candidate="CANDIDATE",s.Offer="OFFER",s.Answer="ANSWER",s.Open="OPEN",s.Error="ERROR",s.IdTaken="ID-TAKEN",s.InvalidKey="INVALID-KEY",s.Leave="LEAVE",s.Expire="EXPIRE"})(fe||(fe={}));var Pr={};Pr=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class Fp extends Mr.EventEmitter{constructor(e,t,n,r,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+n+r+"peerjs?key="+i}start(e,t){this._id=e;const n=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(n+"&version="+Pr.version),this._disconnected=!1,this._socket.onmessage=r=>{let i;try{i=JSON.parse(r.data),M.log("Server message received:",i)}catch{M.log("Invalid server message",r.data);return}this.emit(Ze.Message,i)},this._socket.onclose=r=>{this._disconnected||(M.log("Socket closed.",r),this._cleanup(),this._disconnected=!0,this.emit(Ze.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),M.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){M.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:fe.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ze.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class da{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Xe.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const n=this.connection,r={ordered:!!e.reliable},i=t.createDataChannel(n.label,r);n._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){M.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,n=this.connection.connectionId,r=this.connection.type,i=this.connection.provider;M.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(M.log(`Received ICE candidates for ${t}:`,o.candidate),i.socket.send({type:fe.Candidate,payload:{candidate:o.candidate,type:r,connectionId:n},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":M.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(dn.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":M.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(dn.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":M.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},M.log("Listening for data channel"),e.ondatachannel=o=>{M.log("Received data channel");const a=o.channel;i.getConnection(t,n)._initializeDataChannel(a)},M.log("Listening for remote stream"),e.ontrack=o=>{M.log("Received remote stream");const a=o.streams[0],c=i.getConnection(t,n);if(c.type===Xe.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){M.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let n=!1;const r=this.connection.dataChannel;r&&(n=!!r.readyState&&r.readyState!=="closed"),(t||n)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const n=await e.createOffer(this.connection.options.constraints);M.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),M.log("Set localDescription:",n,`for:${this.connection.peer}`);let r={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Xe.Data){const i=this.connection;r={...r,label:i.label,reliable:i.reliable,serialization:i.serialization}}t.socket.send({type:fe.Offer,payload:r,dst:this.connection.peer})}catch(r){r!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(ie.WebRTC,r),M.log("Failed to setLocalDescription, ",r))}}catch(n){t.emitError(ie.WebRTC,n),M.log("Failed to createOffer, ",n)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const n=await e.createAnswer();M.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),M.log("Set localDescription:",n,`for:${this.connection.peer}`),t.socket.send({type:fe.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(r){t.emitError(ie.WebRTC,r),M.log("Failed to setLocalDescription, ",r)}}catch(n){t.emitError(ie.WebRTC,n),M.log("Failed to create answer, ",n)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const n=this.connection.peerConnection,r=this.connection.provider;M.log("Setting remote description",t);const i=this;try{await n.setRemoteDescription(t),M.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){r.emitError(ie.WebRTC,o),M.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){M.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),M.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(ie.WebRTC,t),M.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(M.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return M.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(n=>{t.addTrack(n,e)})}_addStreamToMediaConnection(e,t){M.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class pa extends Mr.EventEmitter{emitError(e,t){M.error("Error:",t),this.emit("error",new Vp(`${e}`,t))}}class Vp extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class fa extends pa{get open(){return this._open}constructor(e,t,n){super(),this.peer=e,this.provider=t,this.options=n,this._open=!1,this.metadata=n.metadata}}var Us;const on=class on extends fa{get type(){return Xe.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,n){super(e,t,n),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||on.ID_PREFIX+we.randomToken(),this._negotiator=new da(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{M.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{M.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){M.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,n=e.payload;switch(e.type){case fe.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case fe.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:M.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){M.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const n=this.provider._getMessages(this.connectionId);for(const r of n)this.handleMessage(r);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Us=new WeakMap,nn(on,Us,on.ID_PREFIX="mc_");let Jn=on;class Lp{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:n,port:r,path:i,key:o}=this._options,a=new URL(`${t}://${n}:${r}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",Pr.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){M.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==we.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===we.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw M.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var zs,Gs;const yt=class yt extends fa{get type(){return Xe.Data}constructor(e,t,n){super(e,t,n),this.connectionId=this.options.connectionId||yt.ID_PREFIX+ua(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new da(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{M.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{M.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{M.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(pn.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case fe.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case fe.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:M.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};zs=new WeakMap,Gs=new WeakMap,nn(yt,zs,yt.ID_PREFIX="dc_"),nn(yt,Gs,yt.MAX_BUFFERED_AMOUNT=8388608);let Qn=yt;class Nr extends Qn{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Qn.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return M.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class xs extends Nr{close(e){super.close(e),this._chunkedData={}}constructor(e,t,n){super(e,t,n),this.chunker=new la,this.serialization=Yt.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=Eo(e),n=t.__peerData;if(n){if(n.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=new Uint8Array(e.data),n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];const r=Ep(n.data);this._handleDataMessage({data:r})}}_send(e,t){const n=Oo(e);if(n instanceof Promise)return this._send_blob(n);if(!t&&n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);M.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const n of t)this.send(n,!0)}}class jp extends Nr{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Yt.None}}class Bp extends Nr{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),n=t.__peerData;if(n&&n.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const n=this.encoder.encode(this.stringify(e));if(n.byteLength>=we.chunkedMTU){this.emitError(pn.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(n)}constructor(...e){super(...e),this.serialization=Yt.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Ys;const an=class an extends pa{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,n]of this._connections)e[t]=n;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:jp,json:Bp,binary:xs,"binary-utf8":xs,default:xs},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let n;if(e&&e.constructor==Object?t=e:e&&(n=e.toString()),t={debug:0,host:we.CLOUD_HOST,port:we.CLOUD_PORT,path:"/",key:an.DEFAULT_KEY,token:we.randomToken(),config:we.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==we.CLOUD_HOST?this._options.secure=we.isSecure():this._options.host==we.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&M.setLogFunction(this._options.logFunction),M.logLevel=this._options.debug||0,this._api=new Lp(t),this._socket=this._createServerConnection(),!we.supports.audioVideo&&!we.supports.data){this._delayedAbort(ie.BrowserIncompatible,"The current browser does not support WebRTC");return}if(n&&!we.validateId(n)){this._delayedAbort(ie.InvalidID,`ID "${n}" is invalid`);return}n?this._initialize(n):this._api.retrieveId().then(r=>this._initialize(r)).catch(r=>this._abort(ie.ServerError,r))}_createServerConnection(){const e=new Fp(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ze.Message,t=>{this._handleMessage(t)}),e.on(Ze.Error,t=>{this._abort(ie.SocketError,t)}),e.on(Ze.Disconnected,()=>{this.disconnected||(this.emitError(ie.Network,"Lost connection to server."),this.disconnect())}),e.on(Ze.Close,()=>{this.disconnected||this._abort(ie.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,n=e.payload,r=e.src;switch(t){case fe.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case fe.Error:this._abort(ie.ServerError,n.msg);break;case fe.IdTaken:this._abort(ie.UnavailableID,`ID "${this.id}" is taken`);break;case fe.InvalidKey:this._abort(ie.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case fe.Leave:M.log(`Received leave message from ${r}`),this._cleanupPeer(r),this._connections.delete(r);break;case fe.Expire:this.emitError(ie.PeerUnavailable,`Could not connect to peer ${r}`);break;case fe.Offer:{const i=n.connectionId;let o=this.getConnection(r,i);if(o&&(o.close(),M.warn(`Offer received for existing Connection ID:${i}`)),n.type===Xe.Media){const c=new Jn(r,this,{connectionId:i,_payload:n,metadata:n.metadata});o=c,this._addConnection(r,o),this.emit("call",c)}else if(n.type===Xe.Data){const c=new this._serializers[n.serialization](r,this,{connectionId:i,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable});o=c,this._addConnection(r,o),this.emit("connection",c)}else{M.warn(`Received malformed connection type:${n.type}`);return}const a=this._getMessages(i);for(const c of a)o.handleMessage(c);break}default:{if(!n){M.warn(`You received a malformed message from ${r} of type ${t}`);return}const i=n.connectionId,o=this.getConnection(r,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):M.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){M.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(ie.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const n=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,n),n}call(e,t,n={}){if(this.disconnected){M.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(ie.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){M.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const r=new Jn(e,this,{...n,_stream:t});return this._addConnection(e,r),r}_addConnection(e,t){M.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const n=this._connections.get(e);if(!n)return null;for(const r of n)if(r.connectionId===t)return r;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){M.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(M.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const n of t)n.close()}disconnect(){if(this.disconnected)return;const e=this.id;M.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)M.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)M.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(ie.ServerError,t))}};Ys=new WeakMap,nn(an,Ys,an.DEFAULT_KEY="peerjs");let $s=an;var Wp=$s;const qp=document.getElementById("morseText"),$p=document.getElementById("typedText"),Up=document.getElementById("lastMorseText"),zp=document.getElementById("lastTypedText");let We="",Be="";const yi=(s=600,e=.1,t=Ro())=>{new ce(s,"sine").toDestination().start(t).stop(t+e)},Gp=""+Math.floor(Math.random()*1e4).toString().padStart(4,"0"),Dr=new Wp(Gp);let ut=null;Dr.on("open",s=>{document.getElementById("yourId").textContent="ID: "+s});document.getElementById("connectBtn").addEventListener("click",()=>{const s=document.getElementById("peerIdInput").value.trim();ut=Dr.connect(s),ut.on("open",()=>{console.log("Connected to peer:",s)}),ut.on("data",e=>{console.log("Received:",e),We=e.typedText,Be=e.morseText,Vr(e.morseText.trim().split(" ").pop()),Fr()})});Dr.on("connection",s=>{ut=s,ut.on("data",e=>{We=e.typedText,Be=e.morseText,Vr(e.morseText.trim().split(" ").pop()),Fr()})});window.addEventListener("keydown",s=>{const e=document.activeElement;if(e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"))return;const t=s.key.toUpperCase();if(/^[A-Z0-9]$/.test(t)&t!=" "){We+=t;const n=xa.encode(t);Be+=n+" ",Vr(n),We.length>=10&&(We=We.substring(1));let r=Be.trim().split(" ");r.length>=10&&(r.shift(),Be=r.join(" ")+(r.length?" ":"")),vi()}if(s.key==="Backspace"){We="",Be="";let n=Be.trim().split(" ");n.pop(),Be=n.join(" ")+(n.length?" ":""),vi()}Fr()});function Fr(){$p.textContent=We,qp.textContent=Be;const s=Be.split([" "]);console.log(s),zp.textContent=We[We.length-1],Up.textContent=s[s.length-2]}function vi(){ut&&ut.open&&ut.send({typedText:We,morseText:Be})}function Vr(s){let e=Ro();for(let t of s)t==="."?(yi(600,.1,e),e+=.2):t==="-"?(yi(600,.3,e),e+=.4):e+=.2}
